## Integer literals
# NOTE: '_gen_cost' is a misnomer. Positive values increase gen, negative values decrease it
# It's baked into the UI now, though, so I don't wanna change it at this point

# Perk _gen_costs
time_mage_perk_gen_cost = 2
glimpse_the_future_perk_gen_cost = 2
financial_times_perk_gen_cost = 2
celerity_perk_gen_cost = 2
mass_celerity_perk_gen_cost = 2
slowness_perk_gen_cost = 2
mass_slowness_perk_gen_cost = 2
temporal_manipulation_perk_gen_cost = 2
master_of_time_perk_gen_cost = 2
life_mage_perk_gen_cost = 2
inward_reflection_perk_gen_cost = 2
inward_perfection_perk_gen_cost = 2
heal_perk_gen_cost = 2
greater_heal_perk_gen_cost = 2
battlefield_life_mage_perk_gen_cost = 2
greater_battlefield_life_mage_perk_gen_cost = 2
purity_of_body_perk_gen_cost = 2
avatar_of_life_perk_gen_cost = 2
elemental_mage_perk_gen_cost = 2
flame_aura_perk_gen_cost = 2
flaming_weapons_perk_gen_cost = 2
living_earthworks_perk_gen_cost = 2
golem_creation_perk_gen_cost = 2
control_water_perk_gen_cost = 2
drought_perk_gen_cost = 2
elemental_warrior_perk_gen_cost = 2
lord_of_the_elements_perk_gen_cost = 2
death_mage_perk_gen_cost = 2
inflict_illness_perk_gen_cost = 2
plague_lord_perk_gen_cost = 2
aura_of_death_perk_gen_cost = 2
necromancy_perk_gen_cost = 2
drain_life_perk_gen_cost = 2
death_stare_perk_gen_cost = 2
blight_perk_gen_cost = 2
deacon_of_death_perk_gen_cost = 2
biomancy_mage_perk_gen_cost = 2
improve_trait_perk_gen_cost = 2
perfect_trait_perk_gen_cost = 2
fertility_control_perk_gen_cost = 2
impregnate_perk_gen_cost = 2
weaken_trait_perk_gen_cost = 2
criple_trait_perk_gen_cost = 2
sculpter_of_flesh_perk_gen_cost = 2
architect_of_bloodlines_perk_gen_cost = 2
domination_mage_perk_gen_cost = 2
entrance_perk_gen_cost = 2
incite_lust_perk_gen_cost = 2
incite_obedience_perk_gen_cost = 2
dominate_perk_gen_cost = 2
beguiling_aura_perk_gen_cost = 2
friendship_perk_gen_cost = 2
enchanting_aura_perk_gen_cost = 2
master_of_puppets_perk_gen_cost = 2

# Misc _gen_costs
magic_potential_1_gen_cost = 10
magic_potential_2_gen_cost = 20
magic_potential_3_gen_cost = 30
mana_gen_per_magic_circle = 30
mana_gen_lifestyle = 100
mana_gen_legacy_2 = 10
mana_devouring_1_gen_cost = -150
mana_devouring_2_gen_cost = -150

# Perk _max_manas
time_mage_perk_max_mana = 30
glimpse_the_future_perk_max_mana = 30
financial_times_perk_max_mana = 30
celerity_perk_max_mana = 30
mass_celerity_perk_max_mana = 30
slowness_perk_max_mana = 30
mass_slowness_perk_max_mana = 30
temporal_manipulation_perk_max_mana = 30
master_of_time_perk_max_mana = 30
life_mage_perk_max_mana = 30
inward_reflection_perk_max_mana = 30
inward_perfection_perk_max_mana = 30
heal_perk_max_mana = 30
greater_heal_perk_max_mana = 30
battlefield_life_mage_perk_max_mana = 30
greater_battlefield_life_mage_perk_max_mana = 30
purity_of_body_perk_max_mana = 30
avatar_of_life_perk_max_mana = 30
elemental_mage_perk_max_mana = 30
flame_aura_perk_max_mana = 30
flaming_weapons_perk_max_mana = 30
living_earthworks_perk_max_mana = 30
golem_creation_perk_max_mana = 30
control_water_perk_max_mana = 30
drought_perk_max_mana = 30
elemental_warrior_perk_max_mana = 30
lord_of_the_elements_perk_max_mana = 30
death_mage_perk_max_mana = 30
inflict_illness_perk_max_mana = 30
plague_lord_perk_max_mana = 30
aura_of_death_perk_max_mana = 30
necromancy_perk_max_mana = 30
drain_life_perk_max_mana = 30
death_stare_perk_max_mana = 30
blight_perk_max_mana = 30
deacon_of_death_perk_max_mana = 30
biomancy_mage_perk_max_mana = 30
improve_trait_perk_max_mana = 30
perfect_trait_perk_max_mana = 30
fertility_control_perk_max_mana = 30
impregnate_perk_max_mana = 30
weaken_trait_perk_max_mana = 30
criple_trait_perk_max_mana = 30
sculpter_of_flesh_perk_max_mana = 30
architect_of_bloodlines_perk_max_mana = 30
domination_mage_perk_max_mana = 30
entrance_perk_max_mana = 30
incite_lust_perk_max_mana = 30
incite_obedience_perk_max_mana = 30
dominate_perk_max_mana = 30
beguiling_aura_perk_max_mana = 30
friendship_perk_max_mana = 30
enchanting_aura_perk_max_mana = 30
master_of_puppets_perk_max_mana = 30

# Misc _max_manas
max_mana_legacy_3 = 100
max_mana_per_perk = 30
max_mana_per_potency = 100

# MAA-summoning spell amounts
stone_golems_maa_stack_amount = 20
lava_golems_maa_stack_amount = 1
lesser_undead_maa_stack_amount = 200

# Misc
mage_level_legacy_4 = 1

# No-brainer value in a magic mod.
# Uses - Is a character even possibly a mage? 'mage_potency > 0' Is the character not a mage? 'mage_potency < 1' How much potential does this mage have? 'mage_potency >= x'
mage_potency = {
	value = 0
	if = { limit = { has_trait = magic_potential_1 } value = 1 }
	else_if = { limit = { has_trait = magic_potential_2 } value = 2 }
	else_if = { limit = { has_trait = magic_potential_3 } value = 3 }
}

# No-brainer value in a magic mod.
# Uses - Is a character even possibly educated? 'mage_education > 0' Is the character not educated? 'mage_education < 1' How much education does this mage have? 'mage_education >= x'
mage_education = { # UNCOMMENT WHEN SYSTEM IN PLACE!!!
	value = 0
	if = { limit = { has_trait = education_arcane_1 } value = 1 }
	else_if = { limit = { has_trait = education_arcane_2 } value = 2 }
	else_if = { limit = { has_trait = education_arcane_3 } value = 3 }
	else_if = { limit = { has_trait = education_arcane_4 } value = 4 }
}

mage_level_internal_helper = {
	value = var:mage_xp
	divide = 1000
}

mage_level_internal = {
	value = mage_level_internal_helper.tri
}

mage_level = {
	value = mage_level_internal.inc
	if = {
		limit = {
			exists = dynasty
			dynasty = { has_dynasty_perk = arcane_legacy_4 }
		}
		add = 1
	}
}

mage_xp_display = {
	value = mage_level_internal.sum_n.neg
	multiply = 1000
	add = var:mage_xp
}

mage_xp_to_next_level = {
	value = mage_level_internal.inc
	multiply = 1000
}

magic_circles_owned_by_character = {
	value = 0
	every_directly_owned_province = {
		if = {
			limit = { has_building = ancient_magic_mana_circle_01 }
			add = 1
		}
		if = {
			limit = { has_building = ancient_magic_mana_circle_02 }
			add = 2
		}
		if = {
			limit = { has_building = ancient_magic_mana_circle_03 }
			add = 3
		}
	}
}

ancient_magic_mana_gen = {
	value = 0
	add = ancient_magic_mana_gen_gen_only
	add = ancient_magic_mana_gen_drain_only
}

ancient_magic_mana_gen_gen_only = {
	value = 0
	add = ancient_magic_mana_gen_perks
	add = ancient_magic_mana_gen_potency
	add = ancient_magic_mana_gen_circles
	add = ancient_magic_mana_gen_lifestyle
	add = ancient_magic_mana_gen_legacy
}

ancient_magic_mana_gen_potency = {
	value = 0
	if = { limit = { has_trait = magic_potential_1 } add = magic_potential_1_gen_cost }
	else_if = { limit = { has_trait = magic_potential_2 } add = magic_potential_2_gen_cost }
	else_if = { limit = { has_trait = magic_potential_3 } add = magic_potential_3_gen_cost }
}

ancient_magic_mana_gen_circles = {
	value = magic_circles_owned_by_character
	multiply = mana_gen_per_magic_circle
}

ancient_magic_mana_gen_lifestyle = {
	value = 0
	if = {
		limit = { has_focus = magic_mana_focus }
		add = mana_gen_lifestyle
	}
}

ancient_magic_mana_gen_legacy = {
	value = 0
	if = {
		limit = {
			exists = dynasty
			dynasty = { has_dynasty_perk = arcane_legacy_2 }
		}
		add = mana_gen_legacy_2
	}
}

ancient_magic_mana_gen_drain_only = {
	add = ancient_magic_mana_drain_auras
	add = ancient_magic_mana_drain_lifestyle
	add = ancient_magic_mana_drain_disease
}

ancient_magic_mana_drain_auras = {
	value = 0
	add = glimpse_the_future_spell_gen_cost
	add = financial_times_spell_gen_cost
	add = celerity_spell_gen_cost
	add = mass_celerity_spell_gen_cost
	add = slowness_spell_gen_cost
	add = mass_slowness_spell_gen_cost
	add = temporal_manipulation_spell_gen_cost
	add = haste_spell_gen_cost
	add = master_of_time_spell_gen_cost
	add = flame_aura_spell_gen_cost
	add = flaming_weapons_spell_gen_cost
	add = living_earthworks_spell_gen_cost
	add = control_water_spell_gen_cost
	add = drought_spell_gen_cost
	add = elemental_warrior_spell_gen_cost
	add = aura_of_death_spell_gen_cost
	add = blight_spell_gen_cost
	add = fertility_control_spell_gen_cost
	add = beguiling_aura_spell_gen_cost
	add = enchanting_aura_spell_gen_cost
}

ancient_magic_mana_drain_lifestyle = {
	value = 0
	if = {
		limit = { has_focus = magic_arcana_focus }
		subtract = mana_gen_lifestyle
	}
}

ancient_magic_mana_drain_disease = {
	value = 0
	if = {
		limit = { has_trait = mana_devouring_1 }
		add = mana_devouring_1_gen_cost
	}
	else_if = {
		limit = { has_trait = mana_devouring_2 }
		add = mana_devouring_2_gen_cost
	}
}

ancient_magic_max_mana = {
	value = ancient_magic_max_mana_perks
	add = {
		value = mage_potency
		multiply = max_mana_per_potency
	}
	if = {
		limit = {
			exists = dynasty
			dynasty = { has_dynasty_perk = arcane_legacy_3 }
		}
		add = max_mana_legacy_3
	}
}

# Note: This value is a work-around for 'consume life' not giving the 'drained' modifier
# 	    for the correct number of years. Removing it will break that spell!
############################################################################################
spell_caster_mage_level = {
	value = scope:spell_caster.mage_level
}

# Note: This value is a work-around for perks firing 'change_mage_perks'
# 	    more times than they should. Removing it will break everything!
############################################################################################
ancient_magic_mana_gen_perks = {
	value = 0
	# Time tree
	add = { value = time_mage_perk_bit multiply = time_mage_perk_gen_cost }
	add = { value = glimpse_the_future_perk_bit multiply = glimpse_the_future_perk_gen_cost }
	add = { value = financial_times_perk_bit multiply = financial_times_perk_gen_cost }
	add = { value = celerity_perk_bit multiply = celerity_perk_gen_cost }
	add = { value = mass_celerity_perk_bit multiply = mass_celerity_perk_gen_cost }
	add = { value = slowness_perk_bit multiply = slowness_perk_gen_cost }
	add = { value = mass_slowness_perk_bit multiply = mass_slowness_perk_gen_cost }
	add = { value = temporal_manipulation_perk_bit multiply = temporal_manipulation_perk_gen_cost }
	add = { value = master_of_time_perk_bit multiply = master_of_time_perk_gen_cost }

	# Life tree
	add = { value = life_mage_perk_bit multiply = life_mage_perk_gen_cost }
	add = { value = inward_reflection_perk_bit multiply = inward_reflection_perk_gen_cost }
	add = { value = inward_perfection_perk_bit multiply = inward_perfection_perk_gen_cost }
	add = { value = heal_perk_bit multiply = heal_perk_gen_cost }
	add = { value = greater_heal_perk_bit multiply = greater_heal_perk_gen_cost }
	add = { value = battlefield_life_mage_perk_bit multiply = battlefield_life_mage_perk_gen_cost }
	add = { value = greater_battlefield_life_mage_perk_bit multiply = greater_battlefield_life_mage_perk_gen_cost }
	add = { value = purity_of_body_perk_bit multiply = purity_of_body_perk_gen_cost }
	add = { value = avatar_of_life_perk_bit multiply = avatar_of_life_perk_gen_cost }

	# Elemental tree
	add = { value = elemental_mage_perk_bit multiply = elemental_mage_perk_gen_cost }
	add = { value = flame_aura_perk_bit multiply = flame_aura_perk_gen_cost }
	add = { value = flaming_weapons_perk_bit multiply = flaming_weapons_perk_gen_cost }
	add = { value = living_earthworks_perk_bit multiply = living_earthworks_perk_gen_cost }
	add = { value = golem_creation_perk_bit multiply = golem_creation_perk_gen_cost }
	add = { value = control_water_perk_bit multiply = control_water_perk_gen_cost }
	add = { value = drought_perk_bit multiply = drought_perk_gen_cost }
	add = { value = elemental_warrior_perk_bit multiply = elemental_warrior_perk_gen_cost }
	add = { value = lord_of_the_elements_perk_bit multiply = lord_of_the_elements_perk_gen_cost }

	# Death tree
	add = { value = death_mage_perk_bit multiply = death_mage_perk_gen_cost }
	add = { value = inflict_illness_perk_bit multiply = inflict_illness_perk_gen_cost }
	add = { value = plague_lord_perk_bit multiply = plague_lord_perk_gen_cost }
	add = { value = aura_of_death_perk_bit multiply = aura_of_death_perk_gen_cost }
	add = { value = necromancy_perk_bit multiply = necromancy_perk_gen_cost }
	add = { value = drain_life_perk_bit multiply = drain_life_perk_gen_cost }
	add = { value = death_stare_perk_bit multiply = death_stare_perk_gen_cost }
	add = { value = blight_perk_bit multiply = blight_perk_gen_cost }
	add = { value = deacon_of_death_perk_bit multiply = deacon_of_death_perk_gen_cost }

	# Biomancy tree
	add = { value = biomancy_mage_perk_bit multiply = biomancy_mage_perk_gen_cost }
	add = { value = improve_trait_perk_bit multiply = improve_trait_perk_gen_cost }
	add = { value = perfect_trait_perk_bit multiply = perfect_trait_perk_gen_cost }
	add = { value = fertility_control_perk_bit multiply = fertility_control_perk_gen_cost }
	add = { value = impregnate_perk_bit multiply = impregnate_perk_gen_cost }
	add = { value = weaken_trait_perk_bit multiply = weaken_trait_perk_gen_cost }
	add = { value = criple_trait_perk_bit multiply = criple_trait_perk_gen_cost }
	add = { value = sculpter_of_flesh_perk_bit multiply = sculpter_of_flesh_perk_gen_cost }
	add = { value = architect_of_bloodlines_perk_bit multiply = architect_of_bloodlines_perk_gen_cost }

	# Domination tree
	add = { value = domination_mage_perk_bit multiply = domination_mage_perk_gen_cost }
	add = { value = entrance_perk_bit multiply = entrance_perk_gen_cost }
	add = { value = incite_lust_perk_bit multiply = incite_lust_perk_gen_cost }
	add = { value = incite_obedience_perk_bit multiply = incite_obedience_perk_gen_cost }
	add = { value = dominate_perk_bit multiply = dominate_perk_gen_cost }
	add = { value = beguiling_aura_perk_bit multiply = beguiling_aura_perk_gen_cost }
	add = { value = friendship_perk_bit multiply = friendship_perk_gen_cost }
	add = { value = enchanting_aura_perk_bit multiply = enchanting_aura_perk_gen_cost }
	add = { value = master_of_puppets_perk_bit multiply = master_of_puppets_perk_gen_cost }
}

ancient_magic_max_mana_perks = {
	value = 0
	# Time tree
	add = { value = time_mage_perk_bit multiply = time_mage_perk_max_mana }
	add = { value = glimpse_the_future_perk_bit multiply = glimpse_the_future_perk_max_mana }
	add = { value = financial_times_perk_bit multiply = financial_times_perk_max_mana }
	add = { value = celerity_perk_bit multiply = celerity_perk_max_mana }
	add = { value = mass_celerity_perk_bit multiply = mass_celerity_perk_max_mana }
	add = { value = slowness_perk_bit multiply = slowness_perk_max_mana }
	add = { value = mass_slowness_perk_bit multiply = mass_slowness_perk_max_mana }
	add = { value = temporal_manipulation_perk_bit multiply = temporal_manipulation_perk_max_mana }
	add = { value = master_of_time_perk_bit multiply = master_of_time_perk_max_mana }

	# Life tree
	add = { value = life_mage_perk_bit multiply = life_mage_perk_max_mana }
	add = { value = inward_reflection_perk_bit multiply = inward_reflection_perk_max_mana }
	add = { value = inward_perfection_perk_bit multiply = inward_perfection_perk_max_mana }
	add = { value = heal_perk_bit multiply = heal_perk_max_mana }
	add = { value = greater_heal_perk_bit multiply = greater_heal_perk_max_mana }
	add = { value = battlefield_life_mage_perk_bit multiply = battlefield_life_mage_perk_max_mana }
	add = { value = greater_battlefield_life_mage_perk_bit multiply = greater_battlefield_life_mage_perk_max_mana }
	add = { value = purity_of_body_perk_bit multiply = purity_of_body_perk_max_mana }
	add = { value = avatar_of_life_perk_bit multiply = avatar_of_life_perk_max_mana }

	# Elemental tree
	add = { value = elemental_mage_perk_bit multiply = elemental_mage_perk_max_mana }
	add = { value = flame_aura_perk_bit multiply = flame_aura_perk_max_mana }
	add = { value = flaming_weapons_perk_bit multiply = flaming_weapons_perk_max_mana }
	add = { value = living_earthworks_perk_bit multiply = living_earthworks_perk_max_mana }
	add = { value = golem_creation_perk_bit multiply = golem_creation_perk_max_mana }
	add = { value = control_water_perk_bit multiply = control_water_perk_max_mana }
	add = { value = drought_perk_bit multiply = drought_perk_max_mana }
	add = { value = elemental_warrior_perk_bit multiply = elemental_warrior_perk_max_mana }
	add = { value = lord_of_the_elements_perk_bit multiply = lord_of_the_elements_perk_max_mana }

	# Death tree
	add = { value = death_mage_perk_bit multiply = death_mage_perk_max_mana }
	add = { value = inflict_illness_perk_bit multiply = inflict_illness_perk_max_mana }
	add = { value = plague_lord_perk_bit multiply = plague_lord_perk_max_mana }
	add = { value = aura_of_death_perk_bit multiply = aura_of_death_perk_max_mana }
	add = { value = necromancy_perk_bit multiply = necromancy_perk_max_mana }
	add = { value = drain_life_perk_bit multiply = drain_life_perk_max_mana }
	add = { value = death_stare_perk_bit multiply = death_stare_perk_max_mana }
	add = { value = blight_perk_bit multiply = blight_perk_max_mana }
	add = { value = deacon_of_death_perk_bit multiply = deacon_of_death_perk_max_mana }

	# Biomancy tree
	add = { value = biomancy_mage_perk_bit multiply = biomancy_mage_perk_max_mana }
	add = { value = improve_trait_perk_bit multiply = improve_trait_perk_max_mana }
	add = { value = perfect_trait_perk_bit multiply = perfect_trait_perk_max_mana }
	add = { value = fertility_control_perk_bit multiply = fertility_control_perk_max_mana }
	add = { value = impregnate_perk_bit multiply = impregnate_perk_max_mana }
	add = { value = weaken_trait_perk_bit multiply = weaken_trait_perk_max_mana }
	add = { value = criple_trait_perk_bit multiply = criple_trait_perk_max_mana }
	add = { value = sculpter_of_flesh_perk_bit multiply = sculpter_of_flesh_perk_max_mana }
	add = { value = architect_of_bloodlines_perk_bit multiply = architect_of_bloodlines_perk_max_mana }

	# Domination tree
	add = { value = domination_mage_perk_bit multiply = domination_mage_perk_max_mana }
	add = { value = entrance_perk_bit multiply = entrance_perk_max_mana }
	add = { value = incite_lust_perk_bit multiply = incite_lust_perk_max_mana }
	add = { value = incite_obedience_perk_bit multiply = incite_obedience_perk_max_mana }
	add = { value = dominate_perk_bit multiply = dominate_perk_max_mana }
	add = { value = beguiling_aura_perk_bit multiply = beguiling_aura_perk_max_mana }
	add = { value = friendship_perk_bit multiply = friendship_perk_max_mana }
	add = { value = enchanting_aura_perk_bit multiply = enchanting_aura_perk_max_mana }
	add = { value = master_of_puppets_perk_bit multiply = master_of_puppets_perk_max_mana }
}

###########
# Utility
###########

unset = { value = 0 }
set = { value = 1 }
inc = { value = this add = 1 }
dec = { value = this add = -1 }
par = { value = this modulo = 2 }
div2 = { value = this divide = 2 }
mul2 = { value = this multiply = 2 }
clearbit00 = { value = this subtract = par.abs }
rshift01 = { value = clearbit00.div2 }
rshift02 = { value = rshift01.rshift01 }
rshift04 = { value = rshift02.rshift02 }
rshift08 = { value = rshift04.rshift04 }
rshift16 = { value = rshift08.rshift08 }
lshift01 = { value = unset31.mul2 }
lshift02 = { value = lshift01.lshift01 }
lshift04 = { value = lshift02.lshift02 }
lshift08 = { value = lshift04.lshift04 }
lshift16 = { value = lshift08.lshift08 }

bit00 = { value = par }
bit01 = { value = rshift01.par }
bit02 = { value = rshift02.par }
bit03 = { value = rshift02.rshift01.par }
bit04 = { value = rshift04.par }
bit05 = { value = rshift04.rshift01.par }
bit06 = { value = rshift04.rshift02.par }
bit07 = { value = rshift04.rshift02.rshift01.par }
bit08 = { value = rshift08.par }
bit09 = { value = rshift08.rshift01.par }
bit10 = { value = rshift08.rshift02.par }
bit11 = { value = rshift08.rshift02.rshift01.par }
bit12 = { value = rshift08.rshift04.par }
bit13 = { value = rshift08.rshift04.rshift01.par }
bit14 = { value = rshift08.rshift04.rshift02.par }
bit15 = { value = rshift08.rshift04.rshift02.rshift01.par }
bit16 = { value = rshift16.par }
bit17 = { value = rshift16.rshift01.par }
bit18 = { value = rshift16.rshift02.par }
bit19 = { value = rshift16.rshift02.rshift01.par }
bit20 = { value = rshift16.rshift04.par }
bit21 = { value = rshift16.rshift04.rshift01.par }
bit22 = { value = rshift16.rshift04.rshift02.par }
bit23 = { value = rshift16.rshift04.rshift02.rshift01.par }
bit24 = { value = rshift16.rshift08.par }
bit25 = { value = rshift16.rshift08.rshift01.par }
bit26 = { value = rshift16.rshift08.rshift02.par }
bit27 = { value = rshift16.rshift08.rshift02.rshift01.par }
bit28 = { value = rshift16.rshift08.rshift04.par }
bit29 = { value = rshift16.rshift08.rshift04.rshift01.par }
bit30 = { value = rshift16.rshift08.rshift04.rshift02.par }
bit31 = { value = rshift16.rshift08.rshift04.rshift02.rshift01.par }

makebit00 = { value = bit00 }
makebit01 = { value = bit00.lshift01 }
makebit02 = { value = bit00.lshift02 }
makebit03 = { value = bit00.lshift02.lshift01 }
makebit04 = { value = bit00.lshift04 }
makebit05 = { value = bit00.lshift04.lshift01 }
makebit06 = { value = bit00.lshift04.lshift02 }
makebit07 = { value = bit00.lshift04.lshift02.lshift01 }
makebit08 = { value = bit00.lshift08 }
makebit09 = { value = bit00.lshift08.lshift01 }
makebit10 = { value = bit00.lshift08.lshift02 }
makebit11 = { value = bit00.lshift08.lshift02.lshift01 }
makebit12 = { value = bit00.lshift08.lshift04 }
makebit13 = { value = bit00.lshift08.lshift04.lshift01 }
makebit14 = { value = bit00.lshift08.lshift04.lshift02 }
makebit15 = { value = bit00.lshift08.lshift04.lshift02.lshift01 }
makebit16 = { value = bit00.lshift16 }
makebit17 = { value = bit00.lshift16.lshift01 }
makebit18 = { value = bit00.lshift16.lshift02 }
makebit19 = { value = bit00.lshift16.lshift02.lshift01 }
makebit20 = { value = bit00.lshift16.lshift04 }
makebit21 = { value = bit00.lshift16.lshift04.lshift01 }
makebit22 = { value = bit00.lshift16.lshift04.lshift02 }
makebit23 = { value = bit00.lshift16.lshift04.lshift02.lshift01 }
makebit24 = { value = bit00.lshift16.lshift08 }
makebit25 = { value = bit00.lshift16.lshift08.lshift01 }
makebit26 = { value = bit00.lshift16.lshift08.lshift02 }
makebit27 = { value = bit00.lshift16.lshift08.lshift02.lshift01 }
makebit28 = { value = bit00.lshift16.lshift08.lshift04 }
makebit29 = { value = bit00.lshift16.lshift08.lshift04.lshift01 }
makebit30 = { value = bit00.lshift16.lshift08.lshift04.lshift02 }
makebit31 = { value = bit00.lshift16.lshift08.lshift04.lshift02.lshift01 }

flip00 = { value = this if = { limit = { bit00 = unset } add = set.makebit00 } else = { subtract = set.makebit00 } }
flip01 = { value = this if = { limit = { bit01 = unset } add = set.makebit01 } else = { subtract = set.makebit01 } }
flip02 = { value = this if = { limit = { bit02 = unset } add = set.makebit02 } else = { subtract = set.makebit02 } }
flip03 = { value = this if = { limit = { bit03 = unset } add = set.makebit03 } else = { subtract = set.makebit03 } }
flip04 = { value = this if = { limit = { bit04 = unset } add = set.makebit04 } else = { subtract = set.makebit04 } }
flip05 = { value = this if = { limit = { bit05 = unset } add = set.makebit05 } else = { subtract = set.makebit05 } }
flip06 = { value = this if = { limit = { bit06 = unset } add = set.makebit06 } else = { subtract = set.makebit06 } }
flip07 = { value = this if = { limit = { bit07 = unset } add = set.makebit07 } else = { subtract = set.makebit07 } }
flip08 = { value = this if = { limit = { bit08 = unset } add = set.makebit08 } else = { subtract = set.makebit08 } }
flip09 = { value = this if = { limit = { bit09 = unset } add = set.makebit09 } else = { subtract = set.makebit09 } }
flip10 = { value = this if = { limit = { bit10 = unset } add = set.makebit10 } else = { subtract = set.makebit10 } }
flip11 = { value = this if = { limit = { bit11 = unset } add = set.makebit11 } else = { subtract = set.makebit11 } }
flip12 = { value = this if = { limit = { bit12 = unset } add = set.makebit12 } else = { subtract = set.makebit12 } }
flip13 = { value = this if = { limit = { bit13 = unset } add = set.makebit13 } else = { subtract = set.makebit13 } }
flip14 = { value = this if = { limit = { bit14 = unset } add = set.makebit14 } else = { subtract = set.makebit14 } }
flip15 = { value = this if = { limit = { bit15 = unset } add = set.makebit15 } else = { subtract = set.makebit15 } }
flip16 = { value = this if = { limit = { bit16 = unset } add = set.makebit16 } else = { subtract = set.makebit16 } }
flip17 = { value = this if = { limit = { bit17 = unset } add = set.makebit17 } else = { subtract = set.makebit17 } }
flip18 = { value = this if = { limit = { bit18 = unset } add = set.makebit18 } else = { subtract = set.makebit18 } }
flip19 = { value = this if = { limit = { bit19 = unset } add = set.makebit19 } else = { subtract = set.makebit19 } }
flip20 = { value = this if = { limit = { bit20 = unset } add = set.makebit20 } else = { subtract = set.makebit20 } }
flip21 = { value = this if = { limit = { bit21 = unset } add = set.makebit21 } else = { subtract = set.makebit21 } }
flip22 = { value = this if = { limit = { bit22 = unset } add = set.makebit22 } else = { subtract = set.makebit22 } }
flip23 = { value = this if = { limit = { bit23 = unset } add = set.makebit23 } else = { subtract = set.makebit23 } }
flip24 = { value = this if = { limit = { bit24 = unset } add = set.makebit24 } else = { subtract = set.makebit24 } }
flip25 = { value = this if = { limit = { bit25 = unset } add = set.makebit25 } else = { subtract = set.makebit25 } }
flip26 = { value = this if = { limit = { bit26 = unset } add = set.makebit26 } else = { subtract = set.makebit26 } }
flip27 = { value = this if = { limit = { bit27 = unset } add = set.makebit27 } else = { subtract = set.makebit27 } }
flip28 = { value = this if = { limit = { bit28 = unset } add = set.makebit28 } else = { subtract = set.makebit28 } }
flip29 = { value = this if = { limit = { bit29 = unset } add = set.makebit29 } else = { subtract = set.makebit29 } }
flip30 = { value = this if = { limit = { bit30 = unset } add = set.makebit30 } else = { subtract = set.makebit30 } }
flip31 = { value = this if = { limit = { bit31 = unset } add = set.makebit31 } else = { subtract = set.makebit31 } }

set00 = { value = this if = { limit = { bit00 = unset } add = set.makebit00 } }
set01 = { value = this if = { limit = { bit01 = unset } add = set.makebit01 } }
set02 = { value = this if = { limit = { bit02 = unset } add = set.makebit02 } }
set03 = { value = this if = { limit = { bit03 = unset } add = set.makebit03 } }
set04 = { value = this if = { limit = { bit04 = unset } add = set.makebit04 } }
set05 = { value = this if = { limit = { bit05 = unset } add = set.makebit05 } }
set06 = { value = this if = { limit = { bit06 = unset } add = set.makebit06 } }
set07 = { value = this if = { limit = { bit07 = unset } add = set.makebit07 } }
set08 = { value = this if = { limit = { bit08 = unset } add = set.makebit08 } }
set09 = { value = this if = { limit = { bit09 = unset } add = set.makebit09 } }
set10 = { value = this if = { limit = { bit10 = unset } add = set.makebit10 } }
set11 = { value = this if = { limit = { bit11 = unset } add = set.makebit11 } }
set12 = { value = this if = { limit = { bit12 = unset } add = set.makebit12 } }
set13 = { value = this if = { limit = { bit13 = unset } add = set.makebit13 } }
set14 = { value = this if = { limit = { bit14 = unset } add = set.makebit14 } }
set15 = { value = this if = { limit = { bit15 = unset } add = set.makebit15 } }
set16 = { value = this if = { limit = { bit16 = unset } add = set.makebit16 } }
set17 = { value = this if = { limit = { bit17 = unset } add = set.makebit17 } }
set18 = { value = this if = { limit = { bit18 = unset } add = set.makebit18 } }
set19 = { value = this if = { limit = { bit19 = unset } add = set.makebit19 } }
set20 = { value = this if = { limit = { bit20 = unset } add = set.makebit20 } }
set21 = { value = this if = { limit = { bit21 = unset } add = set.makebit21 } }
set22 = { value = this if = { limit = { bit22 = unset } add = set.makebit22 } }
set23 = { value = this if = { limit = { bit23 = unset } add = set.makebit23 } }
set24 = { value = this if = { limit = { bit24 = unset } add = set.makebit24 } }
set25 = { value = this if = { limit = { bit25 = unset } add = set.makebit25 } }
set26 = { value = this if = { limit = { bit26 = unset } add = set.makebit26 } }
set27 = { value = this if = { limit = { bit27 = unset } add = set.makebit27 } }
set28 = { value = this if = { limit = { bit28 = unset } add = set.makebit28 } }
set29 = { value = this if = { limit = { bit29 = unset } add = set.makebit29 } }
set30 = { value = this if = { limit = { bit30 = unset } add = set.makebit30 } }
set31 = { value = this if = { limit = { bit31 = unset } add = set.makebit31 } }

unset00 = { value = this if = { limit = { bit00 = set } subtract = set.makebit00 } }
unset01 = { value = this if = { limit = { bit01 = set } subtract = set.makebit01 } }
unset02 = { value = this if = { limit = { bit02 = set } subtract = set.makebit02 } }
unset03 = { value = this if = { limit = { bit03 = set } subtract = set.makebit03 } }
unset04 = { value = this if = { limit = { bit04 = set } subtract = set.makebit04 } }
unset05 = { value = this if = { limit = { bit05 = set } subtract = set.makebit05 } }
unset06 = { value = this if = { limit = { bit06 = set } subtract = set.makebit06 } }
unset07 = { value = this if = { limit = { bit07 = set } subtract = set.makebit07 } }
unset08 = { value = this if = { limit = { bit08 = set } subtract = set.makebit08 } }
unset09 = { value = this if = { limit = { bit09 = set } subtract = set.makebit09 } }
unset10 = { value = this if = { limit = { bit10 = set } subtract = set.makebit10 } }
unset11 = { value = this if = { limit = { bit11 = set } subtract = set.makebit11 } }
unset12 = { value = this if = { limit = { bit12 = set } subtract = set.makebit12 } }
unset13 = { value = this if = { limit = { bit13 = set } subtract = set.makebit13 } }
unset14 = { value = this if = { limit = { bit14 = set } subtract = set.makebit14 } }
unset15 = { value = this if = { limit = { bit15 = set } subtract = set.makebit15 } }
unset16 = { value = this if = { limit = { bit16 = set } subtract = set.makebit16 } }
unset17 = { value = this if = { limit = { bit17 = set } subtract = set.makebit17 } }
unset18 = { value = this if = { limit = { bit18 = set } subtract = set.makebit18 } }
unset19 = { value = this if = { limit = { bit19 = set } subtract = set.makebit19 } }
unset20 = { value = this if = { limit = { bit20 = set } subtract = set.makebit20 } }
unset21 = { value = this if = { limit = { bit21 = set } subtract = set.makebit21 } }
unset22 = { value = this if = { limit = { bit22 = set } subtract = set.makebit22 } }
unset23 = { value = this if = { limit = { bit23 = set } subtract = set.makebit23 } }
unset24 = { value = this if = { limit = { bit24 = set } subtract = set.makebit24 } }
unset25 = { value = this if = { limit = { bit25 = set } subtract = set.makebit25 } }
unset26 = { value = this if = { limit = { bit26 = set } subtract = set.makebit26 } }
unset27 = { value = this if = { limit = { bit27 = set } subtract = set.makebit27 } }
unset28 = { value = this if = { limit = { bit28 = set } subtract = set.makebit28 } }
unset29 = { value = this if = { limit = { bit29 = set } subtract = set.makebit29 } }
unset30 = { value = this if = { limit = { bit30 = set } subtract = set.makebit30 } }
unset31 = { value = this if = { limit = { bit31 = set } subtract = set.makebit31 } }

and = {
	value = 0
	if = { limit = { bit00 = set prev.bit00 = set } add = set.makebit00 }
	if = { limit = { bit01 = set prev.bit01 = set } add = set.makebit01 }
	if = { limit = { bit02 = set prev.bit02 = set } add = set.makebit02 }
	if = { limit = { bit03 = set prev.bit03 = set } add = set.makebit03 }
	if = { limit = { bit04 = set prev.bit04 = set } add = set.makebit04 }
	if = { limit = { bit05 = set prev.bit05 = set } add = set.makebit05 }
	if = { limit = { bit06 = set prev.bit06 = set } add = set.makebit06 }
	if = { limit = { bit07 = set prev.bit07 = set } add = set.makebit07 }
	if = { limit = { bit08 = set prev.bit08 = set } add = set.makebit08 }
	if = { limit = { bit09 = set prev.bit09 = set } add = set.makebit09 }
	if = { limit = { bit10 = set prev.bit10 = set } add = set.makebit10 }
	if = { limit = { bit11 = set prev.bit11 = set } add = set.makebit11 }
	if = { limit = { bit12 = set prev.bit12 = set } add = set.makebit12 }
	if = { limit = { bit13 = set prev.bit13 = set } add = set.makebit13 }
	if = { limit = { bit14 = set prev.bit14 = set } add = set.makebit14 }
	if = { limit = { bit15 = set prev.bit15 = set } add = set.makebit15 }
	if = { limit = { bit16 = set prev.bit16 = set } add = set.makebit16 }
	if = { limit = { bit17 = set prev.bit17 = set } add = set.makebit17 }
	if = { limit = { bit18 = set prev.bit18 = set } add = set.makebit18 }
	if = { limit = { bit19 = set prev.bit19 = set } add = set.makebit19 }
	if = { limit = { bit20 = set prev.bit20 = set } add = set.makebit20 }
	if = { limit = { bit21 = set prev.bit21 = set } add = set.makebit21 }
	if = { limit = { bit22 = set prev.bit22 = set } add = set.makebit22 }
	if = { limit = { bit23 = set prev.bit23 = set } add = set.makebit23 }
	if = { limit = { bit24 = set prev.bit24 = set } add = set.makebit24 }
	if = { limit = { bit25 = set prev.bit25 = set } add = set.makebit25 }
	if = { limit = { bit26 = set prev.bit26 = set } add = set.makebit26 }
	if = { limit = { bit27 = set prev.bit27 = set } add = set.makebit27 }
	if = { limit = { bit28 = set prev.bit28 = set } add = set.makebit28 }
	if = { limit = { bit29 = set prev.bit29 = set } add = set.makebit29 }
	if = { limit = { bit30 = set prev.bit30 = set } add = set.makebit30 }
	if = { limit = { bit31 = set prev.bit31 = set } add = set.makebit31 }
}
or = {
	value = 0
	if = { limit = { OR = { bit00 = set prev.bit00 = set } } add = set.makebit00 }
	if = { limit = { OR = { bit01 = set prev.bit01 = set } } add = set.makebit01 }
	if = { limit = { OR = { bit02 = set prev.bit02 = set } } add = set.makebit02 }
	if = { limit = { OR = { bit03 = set prev.bit03 = set } } add = set.makebit03 }
	if = { limit = { OR = { bit04 = set prev.bit04 = set } } add = set.makebit04 }
	if = { limit = { OR = { bit05 = set prev.bit05 = set } } add = set.makebit05 }
	if = { limit = { OR = { bit06 = set prev.bit06 = set } } add = set.makebit06 }
	if = { limit = { OR = { bit07 = set prev.bit07 = set } } add = set.makebit07 }
	if = { limit = { OR = { bit08 = set prev.bit08 = set } } add = set.makebit08 }
	if = { limit = { OR = { bit09 = set prev.bit09 = set } } add = set.makebit09 }
	if = { limit = { OR = { bit10 = set prev.bit10 = set } } add = set.makebit10 }
	if = { limit = { OR = { bit11 = set prev.bit11 = set } } add = set.makebit11 }
	if = { limit = { OR = { bit12 = set prev.bit12 = set } } add = set.makebit12 }
	if = { limit = { OR = { bit13 = set prev.bit13 = set } } add = set.makebit13 }
	if = { limit = { OR = { bit14 = set prev.bit14 = set } } add = set.makebit14 }
	if = { limit = { OR = { bit15 = set prev.bit15 = set } } add = set.makebit15 }
	if = { limit = { OR = { bit16 = set prev.bit16 = set } } add = set.makebit16 }
	if = { limit = { OR = { bit17 = set prev.bit17 = set } } add = set.makebit17 }
	if = { limit = { OR = { bit18 = set prev.bit18 = set } } add = set.makebit18 }
	if = { limit = { OR = { bit19 = set prev.bit19 = set } } add = set.makebit19 }
	if = { limit = { OR = { bit20 = set prev.bit20 = set } } add = set.makebit20 }
	if = { limit = { OR = { bit21 = set prev.bit21 = set } } add = set.makebit21 }
	if = { limit = { OR = { bit22 = set prev.bit22 = set } } add = set.makebit22 }
	if = { limit = { OR = { bit23 = set prev.bit23 = set } } add = set.makebit23 }
	if = { limit = { OR = { bit24 = set prev.bit24 = set } } add = set.makebit24 }
	if = { limit = { OR = { bit25 = set prev.bit25 = set } } add = set.makebit25 }
	if = { limit = { OR = { bit26 = set prev.bit26 = set } } add = set.makebit26 }
	if = { limit = { OR = { bit27 = set prev.bit27 = set } } add = set.makebit27 }
	if = { limit = { OR = { bit28 = set prev.bit28 = set } } add = set.makebit28 }
	if = { limit = { OR = { bit29 = set prev.bit29 = set } } add = set.makebit29 }
	if = { limit = { OR = { bit30 = set prev.bit30 = set } } add = set.makebit30 }
	if = { limit = { OR = { bit31 = set prev.bit31 = set } } add = set.makebit31 }
}
not = { value = this add = 1 multiply = -1 }

abs = {
	value = this
	if = {
		limit = { this < 0 }
		multiply = -1
	}
}

neg = {
	value = this
	if = {
		limit = { this > 0 }
		multiply = -1
	}
}

sum_n = {
	value = this
	add = 1
	multiply = this
	divide = 2
}

tri = {
	ordered_province = {
		limit = {
			has_variable = tri_sum
			var:tri_sum < prev
		}
		order_by = var:tri_num
		position = 0
		value = var:tri_num
	}
}
