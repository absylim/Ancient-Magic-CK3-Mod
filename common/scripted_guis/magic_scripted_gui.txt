can_use_magic_window = {
	is_valid = {
		has_trait = mage
	}
}

is_magic_window_open = {
	scope = character
	is_valid = {
		has_variable = window_magic_view
	}
}

toggle_magic_window = {
	scope = character
	effect = {
		if = {
			limit = {
				has_variable = window_magic_view
			}
			effect_close_magic_window = yes
		}
		else = {
			effect_open_magic_window = yes
		}
	}
}

select_character_target = {
	scope = character
	effect = {
		set_variable = {
			name = spell_target
			value = scope:spell_target
		}
	}
}

select_list_option = {
	scope = character
	is_shown = {
		AND = {
			has_variable_list = selected_list_options
			is_target_in_variable_list = {
				name = selected_list_options
				target = scope:list_option
			}
		}
	}
	effect = {
		if = {
			limit = {
				has_variable_list = selected_list_options
				is_target_in_variable_list = {
					name = selected_list_options
					target = scope:list_option
				}
				is_target_in_global_variable_list = {
					name = multiple_option_select_spells
					target = scope:selected_spell
				}
			}
			remove_list_variable = {
				name = selected_list_options
				target = scope:list_option
			}
			if = {
				limit = {
					is_target_in_global_variable_list = {
						name = modify_trait_spells
						target = scope:selected_spell
					}
					var:post_spell_actor = {
						magic_modify_trait_effect = { OPERATION = remove FLAG = scope:list_option }
					}
				}
			}
		}
		else = {
			if = {
				limit = {
					NOT = {
						is_target_in_global_variable_list = {
							name = multiple_option_select_spells
							target = scope:selected_spell
						}
					}
				}
				clear_variable_list = selected_list_options
			}
			add_to_variable_list = {
				name = selected_list_options
				target = scope:list_option
			}
			if = {
				limit = {
					is_target_in_global_variable_list = {
						name = modify_trait_spells
						target = scope:selected_spell
					}
					var:post_spell_actor = {
						magic_modify_trait_effect = { OPERATION = add FLAG = scope:list_option }
					}
				}
			}
		}
	}
}

clear_list_options = {
	effect = {
		clear_variable_list = selected_list_options
	}
}

increase_times_repeated = {
	is_valid = {
		save_temporary_scope_value_as = {
			name = potential_repeat_spell
			value = {
				value = var:repeat_spell
				add = 1
			}
		}
		save_temporary_scope_value_as = {
			name = total_cost
			value = {
				value = scope:potential_repeat_spell
				multiply = scope:spell_cost
			}
		}
		AND = {
			OR = {
				NOT = { trigger_magic_is_aura = { SPELL = scope:spell } }
				scope:potential_repeat_spell < mage_level
			}
			scope:total_cost.compare_value < var:mana
		}
	}
	effect = {
		change_variable = {
			name = repeat_spell
			add = 1
		}
	}
}

decrease_times_repeated = {
	is_valid = {
		var:repeat_spell > 1
	}
	effect = {
		change_variable = {
			name = repeat_spell
			add = -1
		}
	}
}

dummy_spell = {
	is_shown = {
		always = yes
	}
	is_valid = {
		always = no
	}
	effect = {}
}

dummy_spell_spellbook = {
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

dummy_spell_has_properties = {
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

dummy_spell_has_list = {
	is_shown = {
		always = no
	}
	is_valid = {
		always = no
	}
}

clear_trait_list = {
	is_shown = {}
	is_valid = {}
	effect = {
		clear_global_variable_list = trait_list
	}
}

add_to_trait_list = {
	is_shown = {}
	is_valid = {}
	effect = {
		add_to_global_variable_list = { name = trait_list target = scope:trait }
	}
}
