namespace = ancient_magic_alchemy

##############################
#####	Build Laboratory #####
##############################

ancient_magic_alchemy.0001 = { #Location of the lab
	title = ancient_magic_alchemy.0001.t
	desc = ancient_magic_alchemy.0001.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	option = { #In my Castle, hidden away
		name = ancient_magic_alchemy.0001.a 
		custom_tooltip = {
			text = hidden_lab_tooltip
			add_character_flag = hidden_lab
		}
		hidden_effect = {
			change_variable = { name = laboratory_level add = 2 }
			trigger_event = { id = ancient_magic_alchemy.0002 days = 30 }
		}
		
		ai_chance = {
			base = 10
			
			modifier = {
				has_trait = paranoid
				add = 50
			}
		}
	}
	option = { #In an accessible place
		name = ancient_magic_alchemy.0001.b
		custom_tooltip = {
			text = accessible_lab_tooltip
		}
		hidden_effect = {
			change_variable = { name = laboratory_level add = 5 }
			trigger_event = { id = ancient_magic_alchemy.0002 days = 30 }
		}
		ai_chance = {
			base = 0
			modifier = {
				add = learning
			}
			modifier = {
				has_trait = ambitious
				add = 50
			}
			modifier = {
				has_trait = brave
				add = 25
			}
		}
	}
	option = { #On an island or other very remote place
		name = ancient_magic_alchemy.0001.c
		trigger = {
			OR = {
				intrigue = 15
				trait = paranoid
			}
			capital_province = {
				is_coastal = yes
			}
		}
		custom_tooltip = {
			text = very_hidden_lab_tooltip
			add_character_flag = very_hidden_lab
		}
		hidden_effect = {
			change_variable = { name = laboratory_level add = 3 }
			trigger_event = { id = ancient_magic_alchemy.0002 days = 30 }
		}
		
		ai_chance = {
			base = 10
			
			modifier = {
				has_trait = paranoid
				add = 50
			}
			modifier = {
				add = { 
					value = learning
					divide = 2
				}
			}
		}
	}
	option = { #On an island or other very remote place
		name = ancient_magic_alchemy.0001.D
		trigger = {
			OR = {
				intrigue = 15
				trait = paranoid
			}
			capital_province = {
				is_coastal = no
			}
		}
		custom_tooltip = {
			text = very_hidden_lab_tooltip
			add_character_flag = very_hidden_lab
		}
		hidden_effect = {
			change_variable = { name = laboratory_level add = 3 }
			trigger_event = { id = ancient_magic_alchemy.0002 days = 30 }
		}
		
		ai_chance = {
			base = 10
			
			modifier = {
				has_trait = paranoid
				add = 50
			}
			modifier = {
				add = { 
					value = learning
					divide = 2
				}
			}
		}
	}
}

ancient_magic_alchemy.0002 = { #What kind of laboratory should be build
	title = ancient_magic_alchemy.0002.t
	desc = ancient_magic_alchemy.0002.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	option = { #Cheap Setup
		name = ancient_magic_alchemy.0002.a #
		remove_short_term_gold = cheap_laboratory_build_cost
		custom_tooltip = {
			text = cheap_laboratory_setup
		}
		hidden_effect = {
			change_variable = { name = laboratory_level add = 1 }
			set_variable = { name = lab_ambition value = 1 }
			random_list = {
				20 = {
					trigger = { NOT = { has_character_flag = decided_on_glass } }
					trigger_event = { id = ancient_magic_alchemy.0003 days = 60 }
				}
				20 = {
					trigger = { NOT = { has_character_flag = decided_on_crucibles } }
					trigger_event = { id = ancient_magic_alchemy.0004 days = 60 }
				}
				20 = {
					trigger = { NOT = { has_character_flag = decided_on_tools } }
					trigger_event = { id = ancient_magic_alchemy.0005 days = 60 }
				}
				20 = {
					trigger = { NOT = { has_character_flag = decided_on_books } }
					trigger_event = { id = ancient_magic_alchemy.0006 days = 60 }
				}
				20 = {
					trigger = { NOT = { has_character_flag = decided_on_spellcircles } }
					trigger_event = { id = ancient_magic_alchemy.0007 days = 60 }
				}
			}
			random_list = { #Accidents
				25 = { } #Nothing Happens
				25 = { trigger_event = { id = ancient_magic_alchemy.0014 days = 45 } }
				25 = { trigger_event = { id = ancient_magic_alchemy.0015 days = 45 } }
			}
		}
		
		ai_chance = {
			base = 0
			modifier = {
				has_trait = greedy
				add = 100
			}
		}
	}
	option = { #Efficient Setup
		name = ancient_magic_alchemy.0002.b
		remove_short_term_gold = efficient_laboratory_build_cost
		custom_tooltip = {
			text = efficient_laboratory_setup
		}
		hidden_effect = {
			change_variable = { name = laboratory_level add = 3 }
			set_variable = { name = lab_ambition value = 3 }
			random_list = {
				20 = {
					trigger = { NOT = { has_character_flag = decided_on_glass } }
					trigger_event = { id = ancient_magic_alchemy.0003 days = 60 }
				}
				20 = {
					trigger = { NOT = { has_character_flag = decided_on_crucibles } }
					trigger_event = { id = ancient_magic_alchemy.0004 days = 60 }
				}
				20 = {
					trigger = { NOT = { has_character_flag = decided_on_tools } }
					trigger_event = { id = ancient_magic_alchemy.0005 days = 60 }
				}
				20 = {
					trigger = { NOT = { has_character_flag = decided_on_books } }
					trigger_event = { id = ancient_magic_alchemy.0006 days = 60 }
				}
				20 = {
					trigger = { NOT = { has_character_flag = decided_on_spellcircles } }
					trigger_event = { id = ancient_magic_alchemy.0007 days = 60 }
				}
			}
			random_list = { #Accidents
				25 = { } #Nothing Happens
				25 = { trigger_event = { id = ancient_magic_alchemy.0014 days = 45 } }
				25 = { trigger_event = { id = ancient_magic_alchemy.0015 days = 45 } }
			}
		}
		
		ai_chance = {
			base = 10
			modifier = {
				add = { 
					value = learning
					multiply = 2
				}
			}
			modifier = {
				has_trait = ambitious
				add = 150
			}
			modifier = {
				has_trait = mystic_1
				add = 25
			}
			modifier = {
				has_trait = mystic_2
				add = 50
			}
			modifier = {
				has_trait = mystic_3
				add = 75
			}
			modifier = {
				has_trait = greedy
				add = { subtract = 50 }
			}
		}
	}
	option = { #Large Setup
		name = ancient_magic_alchemy.0002.c #State of the Art.
		trigger = {
			OR = {
				learning = 15
			}
		}
		remove_short_term_gold = large_laboratory_build_cost
		custom_tooltip = {
			text = large_laboratory_setup
		}
		hidden_effect = {
			change_variable = { name = laboratory_level add = 5 }
			set_variable = { name = lab_ambition value = 4 }
			random_list = {
				20 = {
					trigger = { NOT = { has_character_flag = decided_on_glass } }
					trigger_event = { id = ancient_magic_alchemy.0003 days = 60 }
				}
				20 = {
					trigger = { NOT = { has_character_flag = decided_on_crucibles } }
					trigger_event = { id = ancient_magic_alchemy.0004 days = 60 }
				}
				20 = {
					trigger = { NOT = { has_character_flag = decided_on_tools } }
					trigger_event = { id = ancient_magic_alchemy.0005 days = 60 }
				}
				20 = {
					trigger = { NOT = { has_character_flag = decided_on_books } }
					trigger_event = { id = ancient_magic_alchemy.0006 days = 60 }
				}
				20 = {
					trigger = { NOT = { has_character_flag = decided_on_spellcircles } }
					trigger_event = { id = ancient_magic_alchemy.0007 days = 60 }
				}
			}
			random_list = { #Accidents
				25 = { } #Nothing Happens
				25 = { trigger_event = { id = ancient_magic_alchemy.0014 days = 45 } }
				25 = { trigger_event = { id = ancient_magic_alchemy.0015 days = 45 } }
			}
		}
		ai_chance = {
			base = 20
			modifier = {
				add = { 
					value = learning
					multiply = 2.5
				}
			}
			modifier = {
				has_trait = ambitious
				add = 200
			}
			modifier = {
				has_trait = mystic_1
				add = 25
			}
			modifier = {
				has_trait = mystic_2
				add = 50
			}
			modifier = {
				has_trait = mystic_3
				add = 75
			}
			modifier = {
				has_trait = greedy
				add = { subtract = 100 }
			}
		}
	}
	option = { #Extravagant Setup
		name = ancient_magic_alchemy.0002.d #Experimental setup
		trigger = {
			OR = {
				learning = 25
			}
		}
		remove_short_term_gold = extravagant_laboratory_build_cost
		custom_tooltip = {
			text = extravagant_laboratory_setup
		}
		hidden_effect = {
			change_variable = { name = laboratory_level add = 8 }
			set_variable = { name = lab_ambition value = 5 }
			random_list = {
				20 = {
					trigger = { NOT = { has_character_flag = decided_on_glass } }
					trigger_event = { id = ancient_magic_alchemy.0003 days = 60 }
				}
				20 = {
					trigger = { NOT = { has_character_flag = decided_on_crucibles } }
					trigger_event = { id = ancient_magic_alchemy.0004 days = 60 }
				}
				20 = {
					trigger = { NOT = { has_character_flag = decided_on_tools } }
					trigger_event = { id = ancient_magic_alchemy.0005 days = 60 }
				}
				20 = {
					trigger = { NOT = { has_character_flag = decided_on_books } }
					trigger_event = { id = ancient_magic_alchemy.0006 days = 60 }
				}
				20 = {
					trigger = { NOT = { has_character_flag = decided_on_spellcircles } }
					trigger_event = { id = ancient_magic_alchemy.0007 days = 60 }
				}
			}
			random_list = { #Accidents
				25 = { } #Nothing Happens
				25 = { trigger_event = { id = ancient_magic_alchemy.0014 days = 45 } }
				25 = { trigger_event = { id = ancient_magic_alchemy.0015 days = 45 } }
			}
		}
		
		ai_chance = {
			base = 25
			modifier = {
				add = { 
					value = learning
					multiply = 3
				}
			}
			modifier = {
				has_trait = ambitious
				add = 250
			}
			modifier = {
				has_trait = mystic_1
				add = 25
			}
			modifier = {
				has_trait = mystic_2
				add = 50
			}
			modifier = {
				has_trait = mystic_3
				add = 75
			}
			modifier = {
				has_trait = greedy
				add = { subtract = 150 }
			}
		}
	}

}

#What kind of equipment do we need?
#Variant 1 - Flasks, Alembics, test tubes, etc
ancient_magic_alchemy.0003 = {
	title = ancient_magic_alchemy.0003.t
	desc = ancient_magic_alchemy.0003.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}

	immediate = {
		hidden_effect = {
			add_character_flag = decided_on_glass
		}
	}
		
	option = {
		name = ancient_magic_alchemy.0003.a #
		custom_tooltip = {
			text = non_fancy_laboratory_glass_tooltip
		}
		hidden_effect = {
			change_variable = {
				name = laboratory_level 
				add = 1
			}
			change_variable = { name = laboratory_glass_level add = 1 }
			change_variable = { name = lab_ambition subtract = 1 }
			if = {
				limit = {
					var:lab_ambition.compare_value = 1
				}
				random_list = {
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_glass } }
						trigger_event = { id = ancient_magic_alchemy.0003 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_crucibles } }
						trigger_event = { id = ancient_magic_alchemy.0004 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_tools } }
						trigger_event = { id = ancient_magic_alchemy.0005 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_books } }
						trigger_event = { id = ancient_magic_alchemy.0006 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_spellcircles } }
						trigger_event = { id = ancient_magic_alchemy.0007 days = 60 }
					}
				}
			}
			else = {
				trigger_event = { id = ancient_magic_alchemy.0008 days = 60 }
			}
		}
	
		ai_chance = {
			base = 10
			modifier = {
				has_trait = greedy
				add = 50
			}
		}
	}
	option = {
		name = ancient_magic_alchemy.0003.b
		remove_short_term_gold = 20
		custom_tooltip = {
			text = fancy_laboratory_glass_tooltip
		}
		hidden_effect = {
			change_variable = { name = laboratory_level add = 2 }
			change_variable = { name = laboratory_glass_level add = 2 }
			change_variable = { name = lab_ambition subtract = 1 }
			if = {
				limit = {
					var:lab_ambition.compare_value = 1
				}
				random_list = {
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_glass } }
						trigger_event = { id = ancient_magic_alchemy.0003 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_crucibles } }
						trigger_event = { id = ancient_magic_alchemy.0004 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_tools } }
						trigger_event = { id = ancient_magic_alchemy.0005 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_books } }
						trigger_event = { id = ancient_magic_alchemy.0006 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_spellcircles } }
						trigger_event = { id = ancient_magic_alchemy.0007 days = 60 }
					}
				}
			}
			else = {
				trigger_event = { id = ancient_magic_alchemy.0008 days = 60 }
			}
		}
	
		ai_chance = {
			base = 10
			modifier = {
				add = learning
			}
			modifier = {
				has_trait = ambitious
				add = 250
			}
			modifier = {
				has_trait = mystic_1
				add = 25
			}
			modifier = {
				has_trait = mystic_2
				add = 50
			}
			modifier = {
				has_trait = mystic_3
				add = 75
			}
			modifier = {
				has_trait = greedy
				add = { subtract = 200 }
			}
		}
	}

}

#Variant 2 - Crucibles
ancient_magic_alchemy.0004 = {
	title = ancient_magic_alchemy.0004.t
	desc = ancient_magic_alchemy.0004.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}

	immediate = {
		hidden_effect = {
			add_character_flag = decided_on_crucibles
		}
	}
	
	option = {
		name = ancient_magic_alchemy.0004.a #
		custom_tooltip = {
			text = non_fancy_laboratory_crucibles_tooltip
		}
		hidden_effect = {
			change_variable = { name = laboratory_level add = 1 }
			change_variable = { name = laboratory_crucible_level add = 1 }
			change_variable = { name = lab_ambition subtract = 1 }
			if = {
				limit = {
					var:lab_ambition.compare_value = 1
				}
				random_list = {
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_glass } }
						trigger_event = { id = ancient_magic_alchemy.0003 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_crucibles } }
						trigger_event = { id = ancient_magic_alchemy.0004 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_tools } }
						trigger_event = { id = ancient_magic_alchemy.0005 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_books } }
						trigger_event = { id = ancient_magic_alchemy.0006 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_spellcircles } }
						trigger_event = { id = ancient_magic_alchemy.0007 days = 60 }
					}
				}
			}
			else = {
				trigger_event = { id = ancient_magic_alchemy.0008 days = 60 }
			}
		}
		
		ai_chance = {
			base = 10
			modifier = {
				has_trait = greedy
				add = 50
			}
		}
	}
	option = {
		name = ancient_magic_alchemy.0004.b
		remove_short_term_gold = 20
		custom_tooltip = {
			text = fancy_laboratory_crucibles_tooltip
		}
		hidden_effect = {
			change_variable = { name = laboratory_level add = 2 }
			change_variable = { name = lab_ambition subtract = 1 }
			change_variable = { name = laboratory_crucible_level add = 2 }
			if = {
				limit = {
					var:lab_ambition.compare_value = 1
				}
				random_list = {
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_glass } }
						trigger_event = { id = ancient_magic_alchemy.0003 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_crucibles } }
						trigger_event = { id = ancient_magic_alchemy.0004 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_tools } }
						trigger_event = { id = ancient_magic_alchemy.0005 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_books } }
						trigger_event = { id = ancient_magic_alchemy.0006 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_spellcircles } }
						trigger_event = { id = ancient_magic_alchemy.0007 days = 60 }
					}
				}
			}
			else = {
				trigger_event = { id = ancient_magic_alchemy.0008 days = 60 }
			}
		}
		
		ai_chance = {
			base = 10
			modifier = {
				add = learning
			}
			modifier = {
				has_trait = ambitious
				add = 250
			}
			modifier = {
				has_trait = mystic_1
				add = 25
			}
			modifier = {
				has_trait = mystic_2
				add = 50
			}
			modifier = {
				has_trait = mystic_3
				add = 75
			}
			modifier = {
				has_trait = greedy
				add = { subtract = 200 }
			}
		}
	}
}

#Variant 3 - Iron Tools
ancient_magic_alchemy.0005 = {
	title = ancient_magic_alchemy.0005.t
	desc = ancient_magic_alchemy.0005.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}

	immediate = {
		hidden_effect = {
			add_character_flag = decided_on_tools
		}
	}

	option = {
		name = ancient_magic_alchemy.0005.a
		custom_tooltip = {
			text = non_fancy_laboratory_tools_tooltip
		}
		hidden_effect = {
			change_variable = { name = laboratory_level add = 1 }
			change_variable = { name = laboratory_iron_tools_level add = 1 }
			change_variable = { name = lab_ambition subtract = 1 }
			if = {
				limit = {
					var:lab_ambition.compare_value = 1
				}
				random_list = {
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_glass } }
						trigger_event = { id = ancient_magic_alchemy.0003 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_crucibles } }
						trigger_event = { id = ancient_magic_alchemy.0004 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_tools } }
						trigger_event = { id = ancient_magic_alchemy.0005 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_books } }
						trigger_event = { id = ancient_magic_alchemy.0006 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_spellcircles } }
						trigger_event = { id = ancient_magic_alchemy.0007 days = 60 }
					}
				}
			}
			else = {
				trigger_event = { id = ancient_magic_alchemy.0008 days = 60 }
			}
		}
		
		ai_chance = {
			base = 10
			modifier = {
				has_trait = greedy
				add = 50
			}
		}
	}
	option = {
		name = ancient_magic_alchemy.0005.b
		remove_short_term_gold = 20
		custom_tooltip = {
			text = fancy_laboratory_tools_tooltip
		}
		hidden_effect = {
			change_variable = { name = laboratory_level add = 2 }
			change_variable = { name = laboratory_iron_tools_level add = 2 }
			change_variable = { name = lab_ambition subtract = 1 }
			if = {
				limit = {
					var:lab_ambition.compare_value = 1
				}
				random_list = {
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_glass } }
						trigger_event = { id = ancient_magic_alchemy.0003 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_crucibles } }
						trigger_event = { id = ancient_magic_alchemy.0004 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_tools } }
						trigger_event = { id = ancient_magic_alchemy.0005 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_books } }
						trigger_event = { id = ancient_magic_alchemy.0006 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_spellcircles } }
						trigger_event = { id = ancient_magic_alchemy.0007 days = 60 }
					}
				}
			}
			else = {
				trigger_event = { id = ancient_magic_alchemy.0008 days = 60 }
			}
		}
		
		ai_chance = {
			base = 10
			modifier = {
				add = learning
			}
			modifier = {
				has_trait = ambitious
				add = 250
			}
			modifier = {
				has_trait = mystic_1
				add = 25
			}
			modifier = {
				has_trait = mystic_2
				add = 50
			}
			modifier = {
				has_trait = mystic_3
				add = 75
			}
			modifier = {
				has_trait = greedy
				add = { subtract = 200 }
			}
		}
	}
}

#Variant 4 - Books
ancient_magic_alchemy.0006 = {
	title = ancient_magic_alchemy.0006.t
	desc = ancient_magic_alchemy.0006.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}

	immediate = {
		hidden_effect = {
			add_character_flag = decided_on_books
		}
	}
	
	option = {
		name = ancient_magic_alchemy.0006.a
		custom_tooltip = {
			text = non_fancy_laboratory_books_tooltip
		}
		hidden_effect = {
			change_variable = { name = laboratory_level add = 1 }
			change_variable = { name = laboratory_books_level add = 1 }
			change_variable = { name = lab_ambition subtract = 1 }
			if = {
				limit = {
					var:lab_ambition.compare_value = 1
				}
				random_list = {
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_glass } }
						trigger_event = { id = ancient_magic_alchemy.0003 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_crucibles } }
						trigger_event = { id = ancient_magic_alchemy.0004 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_tools } }
						trigger_event = { id = ancient_magic_alchemy.0005 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_books } }
						trigger_event = { id = ancient_magic_alchemy.0006 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_spellcircles } }
						trigger_event = { id = ancient_magic_alchemy.0007 days = 60 }
					}
				}
			}
			else = {
				trigger_event = { id = ancient_magic_alchemy.0008 days = 60 }
			}
		}
		
		ai_chance = {
			base = 10
			modifier = {
				has_trait = greedy
				add = 50
			}
		}
	}
	option = {
		name = ancient_magic_alchemy.0006.b
		remove_short_term_gold = 20
		custom_tooltip = {
			text = fancy_laboratory_books_tooltip
		}
		hidden_effect = {
			change_variable = { name = laboratory_level add = 2 }
			change_variable = { name = laboratory_books_level add = 2 }
			change_variable = { name = lab_ambition subtract = 1 }
			if = {
				limit = {
					var:lab_ambition.compare_value = 1
				}
				random_list = {
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_glass } }
						trigger_event = { id = ancient_magic_alchemy.0003 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_crucibles } }
						trigger_event = { id = ancient_magic_alchemy.0004 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_tools } }
						trigger_event = { id = ancient_magic_alchemy.0005 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_books } }
						trigger_event = { id = ancient_magic_alchemy.0006 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_spellcircles } }
						trigger_event = { id = ancient_magic_alchemy.0007 days = 60 }
					}
				}
			}
			else = {
				trigger_event = { id = ancient_magic_alchemy.0008 days = 60 }
			}
		}
		
		ai_chance = {
			base = 10
			modifier = {
				add = learning
			}
			modifier = {
				has_trait = ambitious
				add = 250
			}
			modifier = {
				has_trait = mystic_1
				add = 25
			}
			modifier = {
				has_trait = mystic_2
				add = 50
			}
			modifier = {
				has_trait = mystic_3
				add = 75
			}
			modifier = {
				has_trait = greedy
				add = { subtract = 200 }
			}
		}
	}
}

#Variant 5 - Spellcircles
ancient_magic_alchemy.0007 = {
	title = ancient_magic_alchemy.0007.t
	desc = ancient_magic_alchemy.0007.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}

	immediate = {
		hidden_effect = {
			add_character_flag = decided_on_spellcircles
		}
	}
	
	option = {
		name = ancient_magic_alchemy.0007.a
		custom_tooltip = {
			text = non_fancy_laboratory_spellcircles_tooltip
		}
		hidden_effect = {
			change_variable = { name = laboratory_level add = 1 }
			change_variable = { name = laboratory_spellcircles_level add = 1 }
			change_variable = { name = lab_ambition subtract = 1 }
			if = {
				limit = {
					var:lab_ambition.compare_value = 1
				}
				random_list = {
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_glass } }
						trigger_event = { id = ancient_magic_alchemy.0003 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_crucibles } }
						trigger_event = { id = ancient_magic_alchemy.0004 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_tools } }
						trigger_event = { id = ancient_magic_alchemy.0005 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_books } }
						trigger_event = { id = ancient_magic_alchemy.0006 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_spellcircles } }
						trigger_event = { id = ancient_magic_alchemy.0007 days = 60 }
					}
				}
			}
			else = {
				trigger_event = { id = ancient_magic_alchemy.0008 days = 60 }
			}
		}
		
		ai_chance = {
			base = 10
			modifier = {
				has_trait = greedy
				add = 50
			}
		}
	}
	option = {
		name = ancient_magic_alchemy.0007.b
		trigger = {
			OR = {
				mage_level > 10
				has_trait = magic_crafting
			}
		}
		
		remove_short_term_gold = 20
		custom_tooltip = {
			text = fancy_laboratory_spellcircles_tooltip
		}
		hidden_effect = {
			change_variable = { name = laboratory_level add = 2 }
			change_variable = { name = laboratory_spellcircles_level add = 2 }
			change_variable = { name = lab_ambition subtract = 1 }
			if = {
				limit = {
					var:lab_ambition.compare_value = 1
				}
				random_list = {
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_glass } }
						trigger_event = { id = ancient_magic_alchemy.0003 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_crucibles } }
						trigger_event = { id = ancient_magic_alchemy.0004 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_tools } }
						trigger_event = { id = ancient_magic_alchemy.0005 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_books } }
						trigger_event = { id = ancient_magic_alchemy.0006 days = 60 }
					}
					20 = {
						trigger = { NOT = { has_character_flag = decided_on_spellcircles } }
						trigger_event = { id = ancient_magic_alchemy.0007 days = 60 }
					}
				}
			}
			else = {
				trigger_event = { id = ancient_magic_alchemy.0008 days = 60 }
			}
		}
		
		ai_chance = {
			base = 10
			modifier = {
				add = learning
			}
			modifier = {
				has_trait = ambitious
				add = 250
			}
			modifier = {
				has_trait = mystic_1
				add = 25
			}
			modifier = {
				has_trait = mystic_2
				add = 50
			}
			modifier = {
				has_trait = mystic_3
				add = 75
			}
			modifier = {
				has_trait = greedy
				add = { subtract = 200 }
			}
		}
	}
}

#Work is done
ancient_magic_alchemy.0008 = {
	type = character_event
	theme = learning_scholarship_focus
	
	hidden = yes
	
	immediate = {
		add_character_flag = built_magical_laboratory
		remove_character_flag = decided_on_glass
		remove_character_flag = decided_on_crucibles
		remove_character_flag = decided_on_tools
		remove_character_flag = decided_on_books
		remove_character_flag = decided_on_spellcircles
		if = {
			limit = {
				var:laboratory_level.compare_value < 6
			}
			trigger_event = ancient_magic_alchemy.0009 # Cheap Laboratory
		}
		if = {
			limit = {
				var:laboratory_level.compare_value >= 6
				var:laboratory_level.compare_value < 13
			}
			trigger_event = ancient_magic_alchemy.0010 # Normal Laboratory
		}
		if = {
			limit = {
				var:laboratory_level.compare_value >= 12
				var:laboratory_level.compare_value < 19
			}
			trigger_event = ancient_magic_alchemy.0011 # Good Laboratory
		}
		if = {
			limit = {
				var:laboratory_level.compare_value >= 19
				var:laboratory_level.compare_value < 24
				NOT = {
					check_variable = {
						which = laboratory_level
						value = 23
					}
				}
			}
			trigger_event = ancient_magic_alchemy.0012 # Great Laboratory
		}
		if = {
			limit = {
				var:laboratory_level.compare_value >= 24
			}
			trigger_event = ancient_magic_alchemy.0013 # Best Laboratory
		}
	}
}

#Finished Cheap Lab
ancient_magic_alchemy.0009 = {
	title = ancient_magic_alchemy.0009.t
	desc = ancient_magic_alchemy.0009.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}

	option = {
		name = ancient_magic_alchemy.0009.a #
		add_character_modifier = {
			modifier = cheap_laboratory
		}
		ai_chance = {
			base = 10
		}
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}

#Finished Normal Lab
ancient_magic_alchemy.0010 = {
	title = ancient_magic_alchemy.0010.t
	desc = ancient_magic_alchemy.0010.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}

	option = {
		name = ancient_magic_alchemy.0010.a
		add_character_modifier = {
			modifier = normal_laboratory
		}
		ai_chance = {
			base = 10
		}
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}

#Finished Good Lab
ancient_magic_alchemy.0011 = {
	title = ancient_magic_alchemy.0011.t
	desc = ancient_magic_alchemy.0011.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}

	option = {
		name = ancient_magic_alchemy.0011.a
		add_character_modifier = {
			modifier = good_laboratory
		}
		ai_chance = {
			base = 10
		}
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}

#Finished Great Lab
ancient_magic_alchemy.0012 = {
	title = ancient_magic_alchemy.0012.t
	desc = ancient_magic_alchemy.0012.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}

	option = {
		name = ancient_magic_alchemy.0012.a
		add_character_modifier = {
			modifier = great_laboratory
		}
		ai_chance = {
			base = 10
		}
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}

#Finished Best Lab
ancient_magic_alchemy.0013 = {
	title = ancient_magic_alchemy.0013.t
	desc = ancient_magic_alchemy.0013.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}

	option = {
		name = ancient_magic_alchemy.0013.a
		add_character_modifier = {
			modifier = best_laboratory
		}
		ai_chance = {
			base = 10
		}
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}

#Laboratory Accidents
#Thief causes explosion
ancient_magic_alchemy.0014 = {
	title = ancient_magic_alchemy.0014.t
	desc = ancient_magic_alchemy.0014.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = disgust
	}
	right_portrait = {
		character = scope:sacrifice_for_science
		animation = shame
	}
	
	immediate = {
		hidden_effect = {
			ordered_courtier = {
				order_by = am_interesting_courtier_selection_score
				position = 0
				save_scope_as = sacrifice_for_science
			}
		}
	}

	option = {
		name = ancient_magic_alchemy.0014.a
		hidden_effect = {
			change_variable = { name = laboratory_level subtract = 2 }
		}
		if = {
			limit = { has_character_flag = hidden_lab } #Lab built in castle
			scope:sacrifice_for_science = {
				add_trait = maimed
				stress_impact = {
					trusting = medium_stress_impact_gain
					gregarious = medium_stress_impact_gain
					forgiving = minor_stress_impact_gain
				}
			}
		}
		
		ai_chance = {
			base = 10
			modifier = {
				has_trait = greedy
				add = 50
			}
		}
	}
	option = {
		name = ancient_magic_alchemy.0014.b
		custom_tooltip = {
			text = efforts_to_improve_lab_security_tooltip
		}
		hidden_effect = {
			change_variable = { name = laboratory_level subtract = 1 }
		}
		remove_short_term_gold = 40
		if = {
			limit = { has_character_flag = hidden_lab } #Lab built in castle
			scope:sacrifice_for_science = {
				add_trait = maimed
				stress_impact = {
					trusting = medium_stress_impact_gain
					gregarious = medium_stress_impact_gain
					forgiving = minor_stress_impact_gain
				}
			}
		}
		
		ai_chance = {
			base = 10
			modifier = {
				add = learning
			}
			modifier = {
				has_trait = ambitious
				add = 250
			}
			modifier = {
				has_trait = mystic_1
				add = 25
			}
			modifier = {
				has_trait = mystic_2
				add = 50
			}
			modifier = {
				has_trait = mystic_3
				add = 75
			}
			modifier = {
				has_trait = greedy
				add = { subtract = 200 }
			}
		}
	}

	after = {
		#destroy random ingredient
		if = {
			limit = {
				any_ingredient_in_inventory = {}
			}
			random_ingredient_in_inventory = {
				ROOT = {destroy_artifact = prev}
			}
		}
	}
}

# Locals are gossiping 
ancient_magic_alchemy.0015 = {
	title = ancient_magic_alchemy.0015.t
	desc = ancient_magic_alchemy.0015.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}

	option = {
		name = ancient_magic_alchemy.0015.a
		custom_tooltip = {
			text = accomodate_gossipers_tooltip
		}
		hidden_effect = {
			change_variable = { name = laboratory_level subtract = 2 }
		}
		
		ai_chance = {
			base = 10
			modifier = {
				has_trait = greedy
				add = 50
			}
		}
	}
	option = {
		name = ancient_magic_alchemy.0015.b
		add_character_modifier = {
			modifier = ignored_populace_laboratory
			years = 5
		}
		ai_chance = {
			base = 10
			modifier = {
				add = learning
			}
			modifier = {
				has_trait = ambitious
				add = 250
			}
			modifier = {
				has_trait = mystic_1
				add = 25
			}
			modifier = {
				has_trait = mystic_2
				add = 50
			}
			modifier = {
				has_trait = mystic_3
				add = 75
			}
			modifier = {
				has_trait = greedy
				add = 50
			}
		}
	}
}

#Rotting Ingredients
ancient_magic_alchemy.0016 = {
	title = ancient_magic_alchemy.0016.t
	desc = ancient_magic_alchemy.0016.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}

	option = {
		name = ancient_magic_alchemy.0016.a
		hidden_effect = {
			change_variable = { name = laboratory_level subtract = 1 }
		}
		
		ai_chance = {
			base = 10
			modifier = {
				has_trait = greedy
				add = 50
			}
		}
	}
	option = {
		name = ancient_magic_alchemy.0016.b
		remove_short_term_gold = 40
		hidden_effect = {
			change_variable = { name = laboratory_level add = 1 }
		}
		ai_chance = {
			base = 10
			modifier = {
				add = learning
			}
			modifier = {
				has_trait = ambitious
				add = 250
			}
			modifier = {
				has_trait = mystic_1
				add = 25
			}
			modifier = {
				has_trait = mystic_2
				add = 50
			}
			modifier = {
				has_trait = mystic_3
				add = 75
			}
			modifier = {
				has_trait = greedy
				add = { subtract = 100 }
			}
		}
	}

	after = {
		#destroy ingredients
		#if = {
		#	limit = {
		#		OR = {
		#			has_a_herb_ingredient_trigger = yes
		#			has_an_animal_part_ingredient_trigger = yes
		#		}
		#	}
		#	custom_tooltip = {
		#		text = random_ingredients_are_destroyed_tooltip
		#		destroy_random_herb_or_animal_part_ingredients_effect = yes
		#	}
		#}
	}
}

#############################
####  Upgrade laboratory ####
#############################

#Variant 1 - Flasks, Alembics, test tubes, etc
ancient_magic_alchemy.0050 = {
	title = ancient_magic_alchemy.0050.t
	desc = ancient_magic_alchemy.0050.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	option = { #Basic
		name = ancient_magic_alchemy.0050.a
		
		trigger = {
			laboratory_glass_level < 1
		}
		show_as_unavailable = { #Its useless to make the character to pay for something that he owns
			laboratory_glass_level >= 1
		}
		
		custom_tooltip = {
			text = non_fancy_laboratory_glass_tooltip
		}
		
		remove_short_term_gold = laboratory_glass_level_1_cost
		
		hidden_effect = {
			set_variable = { name = laboratory_glass_level value = 1 }
		}
		
		ai_chance = {
			base = 100
		}
	}
	
	option = { #Intermidiate
		name = ancient_magic_alchemy.0050.b
		
		trigger = {
			laboratory_glass_level < 2
		}
		show_as_unavailable = {
			laboratory_glass_level >= 2
		}
		
		custom_tooltip = {
			text = fancy_laboratory_glass_tooltip
		}
		
		remove_short_term_gold = laboratory_glass_level_2_cost
		
		hidden_effect = {
			set_variable = { name = laboratory_glass_level value = 2 }
		}
		
		ai_chance = {
			base = 100
		}
	}
	
	option = { #Master
		name = ancient_magic_alchemy.0050.c
		
		trigger = {
			laboratory_glass_level < 3
			mage_level > 10
		}
		show_as_unavailable = {
			laboratory_glass_level >= 3
			mage_level < 10
		}
		
		custom_tooltip = {
			text = rare_laboratory_glass_tooltip
		}
		
		remove_short_term_gold = laboratory_glass_level_3_cost
		
		hidden_effect = {
			set_variable = { name = laboratory_glass_level value = 3 }
		}
		
		ai_chance = {
			base = 100
		}
	}
	
	option = { #Grandmaster level
		name = ancient_magic_alchemy.0050.d
		
		custom_tooltip = {
			text = magical_laboratory_glass_tooltip
		}
		
		trigger = {
			laboratory_glass_level < 4
			mage_level > 15
		}
		show_as_unavailable = {
			laboratory_glass_level >= 4
			mage_level < 15
		}
		
		remove_short_term_gold = laboratory_glass_level_4_cost
		
		hidden_effect = {
			set_variable = { name = laboratory_glass_level value = 4 }
		}
		
		ai_chance = {
			base = 100
		}
	}
	
	option = { #exit
		name = ancient_magic_alchemy.0050.exit
		ai_chance = {
			base = 1
		}
	}
}

#Variant 2 - Crucibles
ancient_magic_alchemy.0052 = {
	title = ancient_magic_alchemy.0052.t
	desc = ancient_magic_alchemy.0052.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	option = { #Basic
		name = ancient_magic_alchemy.0052.a
		
		custom_tooltip = {
			text = non_fancy_laboratory_crucibles_tooltip
		}
		
		trigger = {
			laboratory_crucible_level < 1
		}
		show_as_unavailable = { #Its useless to make the character to pay for something that he owns
			laboratory_crucible_level >= 1
		}
		
		remove_short_term_gold = laboratory_crucibles_level_1_cost
		
		hidden_effect = {
			set_variable = { name = laboratory_crucible_level value = 1 }
		}
		
		ai_chance = {
			base = 100
		}
	}
	
	option = { #Intermidiate
		name = ancient_magic_alchemy.0052.b
		
		custom_tooltip = {
			text = fancy_laboratory_crucibles_tooltip
		}
		
		trigger = {
			laboratory_crucible_level < 2
		}
		show_as_unavailable = {
			laboratory_crucible_level >= 2
		}
		
		remove_short_term_gold = laboratory_crucibles_level_2_cost
		
		hidden_effect = {
			set_variable = { name = laboratory_crucible_level value = 2 }
		}
		
		ai_chance = {
			base = 100
		}
	}
	
	option = { #Master
		name = ancient_magic_alchemy.0052.c
		
		custom_tooltip = {
			text = rare_laboratory_crucibles_tooltip
		}
		
		trigger = {
			laboratory_crucible_level < 3
			mage_level > 10
		}
		show_as_unavailable = {
			laboratory_crucible_level >= 3
			mage_level < 10
		}
		
		remove_short_term_gold = laboratory_crucibles_level_3_cost
		
		hidden_effect = {
			set_variable = { name = laboratory_crucible_level value = 3 }
		}
		
		ai_chance = {
			base = 100
		}
	}
	
	option = { #Grandmaster level
		name = ancient_magic_alchemy.0052.d
		
		custom_tooltip = {
			text = magical_laboratory_crucibles_tooltip
		}
		
		trigger = {
			laboratory_crucible_level < 4
			mage_level > 20
		}
		show_as_unavailable = {
			laboratory_crucible_level >= 4
			mage_level < 20
		}
		
		remove_short_term_gold = laboratory_crucibles_level_4_cost
		
		hidden_effect = {
			set_variable = { name = laboratory_crucible_level value = 4 }
		}
		
		ai_chance = {
			base = 100
		}
	}
	
	option = { #exit
		name = ancient_magic_alchemy.0050.exit
		ai_chance = {
			base = 1
		}
	}
}

#Variant 3 - Iron Tools
ancient_magic_alchemy.0054 = {
	title = ancient_magic_alchemy.0054.t
	desc = ancient_magic_alchemy.0054.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	option = { #Basic
		name = ancient_magic_alchemy.0054.a
		
		trigger = {
			laboratory_iron_tools_level < 1
		}
		show_as_unavailable = { #Its useless to make the character to pay for something that he owns
			laboratory_iron_tools_level >= 1
		}
		
		custom_tooltip = {
			text = non_fancy_laboratory_tools_tooltip
		}
		
		remove_short_term_gold = laboratory_iron_tools_level_1_cost
		
		hidden_effect = {
			set_variable = { name = laboratory_iron_tools_level value = 1 }
		}
		
		ai_chance = {
			base = 100
		}
	}
	
	option = { #Intermidiate
		name = ancient_magic_alchemy.0054.b;
		
		trigger = {
			laboratory_iron_tools_level < 2
		}
		show_as_unavailable = {
			laboratory_iron_tools_level >= 2
		}
		
		custom_tooltip = {
			text = fancy_laboratory_tools_tooltip
		}
		
		remove_short_term_gold = laboratory_iron_tools_level_2_cost
		
		hidden_effect = {
			set_variable = { name = laboratory_iron_tools_level value = 2 }
		}
		
		ai_chance = {
			base = 100
		}
	}
	
	option = { #Master
		name = ancient_magic_alchemy.0054.c
		
		trigger = {
			laboratory_iron_tools_level < 3
			mage_level > 10
		}
		show_as_unavailable = {
			laboratory_iron_tools_level >= 3
			mage_level < 10
		}
		
		custom_tooltip = {
			text = rare_laboratory_tools_tooltip
		}
		
		remove_short_term_gold = laboratory_iron_tools_level_3_cost
		
		hidden_effect = {
			set_variable = { name = laboratory_iron_tools_level value = 3 }
		}
		
		ai_chance = {
			base = 100
		}
	}
	
	option = { #Grandmaster level
		name = ancient_magic_alchemy.0054.d
		
		trigger = {
			laboratory_iron_tools_level < 4
			mage_level > 15
		}
		show_as_unavailable = {
			laboratory_iron_tools_level >= 4
			mage_level < 15
		}
		
		custom_tooltip = {
			text = magical_laboratory_tools_tooltip
		}
		
		remove_short_term_gold = laboratory_iron_tools_level_4_cost
		
		hidden_effect = {
			set_variable = { name = laboratory_iron_tools_level value = 4 }
		}
		
		ai_chance = {
			base = 100
		}
	}
	
	option = { #exit
		name = ancient_magic_alchemy.0050.exit
		ai_chance = {
			base = 1
		}
	}
}

#Variant 4 - Books
ancient_magic_alchemy.0056 = {
	title = ancient_magic_alchemy.0056.t
	desc = ancient_magic_alchemy.0056.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	option = { #Basic
		name = ancient_magic_alchemy.0056.a
		
		trigger = {
			laboratory_books_level < 1
		}
		show_as_unavailable = { #Its useless to make the character to pay for something that he owns
			laboratory_books_level >= 1
		}
		
		custom_tooltip = {
			text = non_fancy_laboratory_books_tooltip
		}
		
		remove_short_term_gold = laboratory_books_level_1_cost
		
		hidden_effect = {
			set_variable = { name = laboratory_books_level value = 1 }
		}
		
		ai_chance = {
			base = 100
		}
	}
	
	option = { #Intermidiate
		name = ancient_magic_alchemy.0056.b
		
		trigger = {
			laboratory_books_level < 2
		}
		show_as_unavailable = {
			laboratory_books_level >= 2
		}
		
		custom_tooltip = {
			text = fancy_laboratory_books_tooltip
		}
		
		remove_short_term_gold = laboratory_books_level_2_cost
		
		hidden_effect = {
			set_variable = { name = laboratory_books_level value = 2 }
		}
		
		ai_chance = {
			base = 100
		}
	}
	
	option = { #Master
		name = ancient_magic_alchemy.0056.c
		
		trigger = {
			laboratory_books_level < 3
		}
		show_as_unavailable = {
			laboratory_books_level >= 3
			mage_level < 15
		}
		
		custom_tooltip = {
			text = rare_laboratory_books_tooltip
		}
		
		remove_short_term_gold = laboratory_books_level_3_cost
		
		hidden_effect = {
			set_variable = { name = laboratory_books_level value = 3 }
		}
		
		ai_chance = {
			base = 100
		}
	}
	
	option = { #Grandmaster level
		name = ancient_magic_alchemy.0056.d
		
		trigger = {
			laboratory_books_level < 4
		}
		show_as_unavailable = {
			laboratory_books_level >= 4
			mage_level < 20
		}
		
		custom_tooltip = {
			text = magical_laboratory_books_tooltip
		}
		
		remove_short_term_gold = laboratory_books_level_4_cost
		
		hidden_effect = {
			set_variable = { name = laboratory_books_level value = 4 }
		}
		
		ai_chance = {
			base = 100
		}
	}
	
	option = { #exit
		name = ancient_magic_alchemy.0050.exit
		ai_chance = {
			base = 1
		}
	}
}

#Variant 5 - Spellcircles
ancient_magic_alchemy.0058 = {
	title = ancient_magic_alchemy.0058.t
	desc = ancient_magic_alchemy.0058.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	option = { #Basic
		name = ancient_magic_alchemy.0058.a
		
		trigger = {
			laboratory_spellcircles_level < 1
		}
		show_as_unavailable = { #Its useless to make the character to pay for something that he owns
			laboratory_spellcircles_level >= 1
		}
		
		custom_tooltip = {
			text = non_fancy_laboratory_spellcircles_tooltip
		}
		
		remove_short_term_gold = laboratory_spellcircles_level_1_cost
		
		hidden_effect = {
			set_variable = { name = laboratory_spellcircles_level value = 1 }
		}
		
		ai_chance = {
			base = 100
		}
	}
	
	option = { #Intermidiate
		name = ancient_magic_alchemy.0058.b
		
		trigger = {
			laboratory_spellcircles_level < 2
			mage_level > 10
		}
		show_as_unavailable = {
			laboratory_spellcircles_level >= 2
			mage_level < 10
		}
		
		custom_tooltip = {
			text = fancy_laboratory_spellcircles_tooltip
		}
		
		remove_short_term_gold = laboratory_spellcircles_level_2_cost
		
		hidden_effect = {
			set_variable = { name = laboratory_spellcircles_level value = 2 }
		}
		
		ai_chance = {
			base = 100
		}
	}
	
	option = { #Master
		name = ancient_magic_alchemy.0058.c
		
		trigger = {
			laboratory_spellcircles_level < 3
			mage_level > 20
		}
		show_as_unavailable = {
			laboratory_spellcircles_level >= 3
			mage_level < 20
		}
		
		custom_tooltip = {
			text = rare_laboratory_spellcircles_tooltip
		}
		
		remove_short_term_gold = laboratory_spellcircles_level_3_cost
		
		hidden_effect = {
			set_variable = { name = laboratory_spellcircles_level value = 3 }
		}
		
		ai_chance = {
			base = 100
		}
	}
	
	option = { #Grandmaster level
		name = ancient_magic_alchemy.0058.d
		
		trigger = { #Dont know what to write here
			always = no
			laboratory_spellcircles_level < 4
		}
		
		show_as_unavailable = {
			laboratory_spellcircles_level >= 4
			mage_level < 25
		}
		
		custom_tooltip = {
			text = magical_laboratory_spellcircles_tooltip
		}
		
		remove_short_term_gold = laboratory_spellcircles_level_4_cost
		
		hidden_effect = {
			set_variable = { name = laboratory_spellcircles_level value = 4 }
		}
		
		ai_chance = {
			base = 100
		}
	}
	
	option = { #exit
		name = ancient_magic_alchemy.0050.exit
		ai_chance = {
			base = 1
		}
	}
}

#############################
#####	Use laboratory	#####
#############################

#### Perform Experiments ####
ancient_magic_alchemy.0100 = { #Who is gonna perform the experiments (WIP)
	title = ancient_magic_alchemy.0100.t
	desc = ancient_magic_alchemy.0100.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	option = { #I will perform the experiment
		name = ancient_magic_alchemy.0100.self
		
		capital_province = {
			spawn_activity = {
				owner = ROOT
				type = activity_alchemy_experiments
			}
		}
		ai_chance = {
			base = 10
		}
	}
	
	option = { #exit
		name = ancient_magic_alchemy.0050.exit
		trigger = {
			is_ai = no
		}
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}

ancient_magic_alchemy.0101 = { #What kind of experiments should be performed
	title = ancient_magic_alchemy.0101.t
	desc = ancient_magic_alchemy.0101.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	immediate = {
		ROOT = { save_scope_as = enchanter }
	}
	
	option = { #Combine materials
		name = ancient_magic_alchemy.0101.a
		trigger_event = ancient_magic_alchemy.0102
	}
	
	option = { #Experiment with impirinting spells on items
		name = ancient_magic_alchemy.0101.b
		trigger = {
			any_ingredient_in_inventory = {
				has_artifact_feature_group = compressed_mana
			}
		}
		
		trigger_event = ancient_magic_alchemy.0102
	}
	
	option = { #Botanical Alchemy
		name = ancient_magic_alchemy.0101.c
		trigger_event = ancient_magic_alchemy.0125
	}
	
	option = { #Magical Experiments
		name = ancient_magic_alchemy.0101.d
		trigger = {
			always = no
		}
		trigger_event = ancient_magic_alchemy.0150
	}
	
	option = { #exit
		name = ancient_magic_alchemy.0050.exit
		trigger = {
			is_ai = no
		}
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}

ancient_magic_alchemy.0102 = { #Combine materials - choose type
	title = ancient_magic_alchemy.0102.t
	desc = ancient_magic_alchemy.0102.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
		
	option = { #combine with special materials
		name = ancient_magic_alchemy.0102.a
		trigger = {
			any_ingredient_in_inventory = {
				OR = {
					has_artifact_feature_group = herbs
					has_artifact_feature_group = special_metals
					has_artifact_feature_group = ores
					has_artifact_feature_group = wood
				}
			}
			always = no # For now this event chain is not used (WIP)
		}
		
		trigger_event = ancient_magic_alchemy.0103
	}
	
	option = { #Magicaly enhance materials
		name = ancient_magic_alchemy.0102.b
		trigger = {
			any_ingredient_in_inventory = {
				has_artifact_feature = mana_vial
			}
		}
		
		random_ingredient_in_inventory = {
			limit = {
				has_artifact_feature = mana_vial
			}
			ROOT = {destroy_artifact = prev}
		}
		
		trigger_event = { id = ancient_magic_alchemy.0104 days = { 0 5 } }
	}
	
	option = { #Combine mundane material
		name = ancient_magic_alchemy.0102.c
		
		trigger_event = { id = ancient_magic_alchemy.0105 days = { 0 5 } }
	}
	
	option = { #Go back
		name = ancient_magic_alchemy.0125.back
		trigger_event = ancient_magic_alchemy.0101
	}
}
#Investments
ancient_magic_alchemy.0103 = { #Combine materials - investment (Type A)
	title = ancient_magic_alchemy.0103.t
	desc = ancient_magic_alchemy.0103.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	immediate = {
		set_variable = {
			name = investment
			value = 0
		}
	}
	
	option = { #efficient investment
		name = ancient_magic_alchemy.0103.d
		skill = stewardship
		remove_short_term_gold = 100
		trigger = {
			stewardship > 15
		}
		hidden_effect = {
			change_variable = { name = investment add = 3 }
		}
	}
	
	option = { #bare minimum
		name = ancient_magic_alchemy.0103.a
		remove_short_term_gold = 35
		hidden_effect = {
			change_variable = { name = investment add = 1 }
		}
	}
	
	option = { #medium investment
		name = ancient_magic_alchemy.0103.b
		remove_short_term_gold = 75
		hidden_effect = {
			change_variable = { name = investment add = 2 }
		}
	}
	
	option = { #great investment
		name = ancient_magic_alchemy.0103.c
		remove_short_term_gold = 150
		hidden_effect = {
			change_variable = { name = investment add = 3 }
		}
	}
	
	after = {
		random_list = { #what happens
			1 = { trigger_event = { id = ancient_magic_alchemy.0201 days = { 100 460 } } }
		}
		random_list = { #random accident
			1 = {} #nothing happens
		}
	}
}

ancient_magic_alchemy.0104 = { #Combine materials - investment (Type B)
	title = ancient_magic_alchemy.0103.t
	desc = ancient_magic_alchemy.0103.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	immediate = {
		set_variable = {
			name = investment
			value = 0
		}
	}
	
	option = { #efficient investment
		name = ancient_magic_alchemy.0103.d
		skill = stewardship
		remove_short_term_gold = 100
		trigger = {
			stewardship > 15
		}
		hidden_effect = {
			change_variable = { name = investment add = 3 }
		}
	}
	
	option = { #bare minimum
		name = ancient_magic_alchemy.0103.a
		remove_short_term_gold = 35
		hidden_effect = {
			change_variable = { name = investment add = 1 }
		}
	}
	
	option = { #medium investment
		name = ancient_magic_alchemy.0103.b
		remove_short_term_gold = 75
		hidden_effect = {
			change_variable = { name = investment add = 2 }
		}
	}
	
	option = { #great investment
		name = ancient_magic_alchemy.0103.c
		remove_short_term_gold = 150
		hidden_effect = {
			change_variable = { name = investment add = 3 }
		}
	}
	
	after = {
		random_list = { #what happens
			1 = { trigger_event = { id = ancient_magic_alchemy.0201 days = { 100 460 } } }
		}
		random_list = { #random accident
			1 = {} #nothing happens
		}
	}
}

ancient_magic_alchemy.0105 = { #Combine materials - investment (Type C)
	title = ancient_magic_alchemy.0103.t
	desc = ancient_magic_alchemy.0103.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	immediate = {
		set_variable = {
			name = investment
			value = 0
		}
	}
	
	option = { #efficient investment
		name = ancient_magic_alchemy.0103.d
		skill = stewardship
		remove_short_term_gold = 125
		trigger = {
			stewardship > 15
		}
		hidden_effect = {
			change_variable = { name = investment add = 3 }
		}
	}
	
	option = { #bare minimum
		name = ancient_magic_alchemy.0103.a
		remove_short_term_gold = 50
		hidden_effect = {
			change_variable = { name = investment add = 1 }
		}
	}
	
	option = { #medium investment
		name = ancient_magic_alchemy.0103.b
		remove_short_term_gold = 100
		hidden_effect = {
			change_variable = { name = investment add = 2 }
		}
	}
	
	option = { #great investment
		name = ancient_magic_alchemy.0103.c
		remove_short_term_gold = 200
		hidden_effect = {
			change_variable = { name = investment add = 3 }
		}
	}
	
	after = {
		random_list = { #what happens
			1 = { trigger_event = { id = ancient_magic_alchemy.0200 days = { 80 400 } } }
		}
		random_list = { #random accident
			1 = {} #nothing happens
		}
	}
}

##Enchantment Experiments
ancient_magic_alchemy.0107 = {
	title = ancient_magic_alchemy.0107.t
	desc = ancient_magic_alchemy.0107.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	option = { #Experiment on weapon
		name = ancient_magic_alchemy.0107.weapon
		trigger = {
			any_character_artifact = {
				artifact_slot_type = primary_armament
			}
		}
		
		trigger_event = { id = ancient_magic_alchemy.0110 }
	}
	
	option = { #Experiment on armor
		name = ancient_magic_alchemy.0107.armor
		trigger = {
			any_character_artifact = {
				artifact_slot_type = armor
			}
		}
		
		trigger_event = { id = ancient_magic_alchemy.0111 }
	}
	
	option = { #Experiment on necklace
		name = ancient_magic_alchemy.0107.necklace
		trigger = {
			any_character_artifact = {
				artifact_type = necklace
			}
		}
		
		trigger_event = { id = ancient_magic_alchemy.0112 }
	}
	
	option = { #Experiment on trinket
		name = ancient_magic_alchemy.0107.trinket
		trigger = {
			any_character_artifact = {
				artifact_slot_type = miscellaneous
				NOT = { artifact_type = necklace }
				NOT = { 
					OR = { 
						has_artifact_feature_group = book_subject 
						has_artifact_feature_group = book_cover_material 
						has_artifact_feature_group = book_title 
						has_artifact_feature_group = book_topic 
						has_artifact_feature_group = book_decoration 
					}
				}
			}
		}
		
		trigger_event = { id = ancient_magic_alchemy.0113 }
	}
	
	option = { #Buy some trinket on market
		name = ancient_magic_alchemy.0107.buy
		
		trigger_event = { id = ancient_magic_alchemy.0114 days = { 5 15 } }
	}
	
	option = { #exit
		name = ancient_magic_alchemy.0050.exit
		trigger = {
			is_ai = no
		}
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}

#choose artifact for experiment
ancient_magic_alchemy.0110 = { #Choose weapon
	title = ancient_magic_alchemy.0110.t
	desc = ancient_magic_alchemy.01110.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	artifact = {
        target = scope:this_artifact
        position = lower_center_portrait  
		trigger = {
			ROOT = {
				any_character_artifact = {
					count = 1
					artifact_slot_type = primary_armament
				}
			}
		}
    }
	artifact = { # To display the artifact in the event-window
        target = scope:first_artifact
        position = lower_left_portrait 
		trigger = {
			ROOT = {
				any_character_artifact = {
					count > 1
					artifact_slot_type = primary_armament
				}
			}
		}
    }
	artifact = {
        target = scope:second_artifact
        position = lower_right_portrait 
		trigger = {
			ROOT = {
				any_character_artifact = {
					count > 1
					artifact_slot_type = primary_armament
				}
			}
		}
    }
	
	immediate = {
		if = {
			limit = {
				any_character_artifact = {
					count > 1
					artifact_slot_type = primary_armament
				}
			}
			ordered_character_artifact = {
				limit = {
					artifact_slot_type = primary_armament
				}
				order_by = var:quality
				position = 0

				save_scope_as = first_artifact
			}
			ordered_character_artifact = {
				limit = {
					artifact_slot_type = primary_armament
					NOT = { this = first_artifact }
				}
				order_by = var:quality
				position = 100 #probability that anyone has over 100 weapons is very low, so to get the one with lowest quality

				save_scope_as = second_artifact
			}
		}
		else = {
			random_character_artifact = {
				limit = {
					artifact_slot_type = primary_armament
				}

				save_scope_as = this_artifact
			}
		}
	}
	
	option = { #choose first artifact
		name = ancient_magic_alchemy.0110.only
		trigger = {
			any_character_artifact = {
				count = 1
				artifact_slot_type = primary_armament
			}
		}
		
		hidden_effect = {
			scope:this_artifact = {
				save_scope_as = chosen_artifact
			}
		}
		
		trigger_event = ancient_magic_alchemy.0115
	}
	option = { #choose first artifact
		name = ancient_magic_alchemy.0110.best
		trigger = {
			any_character_artifact = {
				count > 1
				artifact_slot_type = primary_armament
			}
		}
		
		hidden_effect = {
			scope:first_artifact = {
				save_scope_as = chosen_artifact
			}
		}
		
		trigger_event = ancient_magic_alchemy.0115
	}
	
	option = { #choose second artifact
		name = ancient_magic_alchemy.0110.worst
		trigger = {
			any_character_artifact = {
				count > 1
				artifact_slot_type = primary_armament
			}
		}
		
		hidden_effect = {
			scope:second_artifact = {
				save_scope_as = chosen_artifact
			}
		}
		
		trigger_event = ancient_magic_alchemy.0115
	}
	
	option = { #Go back
		name = ancient_magic_alchemy.0125.back
		trigger_event = ancient_magic_alchemy.0107
	}
}

ancient_magic_alchemy.0111 = { #Choose armor
	title = ancient_magic_alchemy.0111.t
	desc = ancient_magic_alchemy.0111.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	artifact = {
        target = scope:this_artifact
        position = lower_center_portrait  
		trigger = {
			ROOT = {
				any_character_artifact = {
					count = 1
					artifact_slot_type = armor
				}
			}
		}
    }
	artifact = { # To display the artifact in the event-window
        target = scope:first_artifact
        position = lower_left_portrait 
		trigger = {
			ROOT = {
				any_character_artifact = {
					count > 1
					artifact_slot_type = armor
				}
			}
		}
    }
	artifact = {
        target = scope:second_artifact
        position = lower_right_portrait 
		trigger = {
			ROOT = {
				any_character_artifact = {
					count > 1
					artifact_slot_type = armor
				}
			}
		}
    }
	
	immediate = {
		if = {
			limit = {
				any_character_artifact = {
					count > 1
					artifact_slot_type = armor
				}
			}
			ordered_character_artifact = {
				limit = {
					artifact_slot_type = armor
				}
				order_by = var:quality
				position = 0

				save_scope_as = first_artifact
			}
			ordered_character_artifact = {
				limit = {
					artifact_slot_type = armor
					NOT = { this = first_artifact }
				}
				order_by = var:quality
				position = 100 #probability that anyone has over 100 weapons is very low, so to get the one with lowest quality

				save_scope_as = second_artifact
			}
		}
		else = {
			random_character_artifact = {
				limit = {
					artifact_slot_type = armor
				}

				save_scope_as = this_artifact
			}
		}
	}
	
	option = { #choose first artifact
		name = ancient_magic_alchemy.0111.only
		trigger = {
			any_character_artifact = {
				count = 1
				artifact_slot_type = armor
			}
		}
		
		hidden_effect = {
			scope:this_artifact = {
				save_scope_as = chosen_artifact
			}
		}
		
		trigger_event = ancient_magic_alchemy.0115
	}
	option = { #choose first artifact
		name = ancient_magic_alchemy.0111.best
		trigger = {
			any_character_artifact = {
				count > 1
				artifact_slot_type = armor
			}
		}
		
		hidden_effect = {
			scope:first_artifact = {
				save_scope_as = chosen_artifact
			}
		}
		
		trigger_event = ancient_magic_alchemy.0115
	}
	
	option = { #choose second artifact
		name = ancient_magic_alchemy.0111.worst
		trigger = {
			any_character_artifact = {
				count > 1
				artifact_slot_type = armor
			}
		}
		
		hidden_effect = {
			scope:second_artifact = {
				save_scope_as = chosen_artifact
			}
		}
		
		trigger_event = ancient_magic_alchemy.0115
	}
	
	option = { #Go back
		name = ancient_magic_alchemy.0125.back
		trigger_event = ancient_magic_alchemy.0107
	}
}

ancient_magic_alchemy.0112 = { #Choose necklace
	title = ancient_magic_alchemy.0112.t
	desc = ancient_magic_alchemy.0112.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	artifact = {
        target = scope:this_artifact
        position = lower_center_portrait  
		trigger = {
			ROOT = {
				any_character_artifact = {
					count = 1
					artifact_type = necklace
				}
			}
		}
    }
	artifact = { # To display the artifact in the event-window
        target = scope:first_artifact
        position = lower_left_portrait 
		trigger = {
			ROOT = {
				any_character_artifact = {
					count > 1
					artifact_type = necklace
				}
			}
		}
    }
	artifact = {
        target = scope:second_artifact
        position = lower_right_portrait 
		trigger = {
			ROOT = {
				any_character_artifact = {
					count > 1
					artifact_type = necklace
				}
			}
		}
    }
	
	immediate = {
		if = {
			limit = {
				any_character_artifact = {
					count > 1
					artifact_type = necklace
				}
			}
			ordered_character_artifact = {
				limit = {
					artifact_type = necklace
				}
				order_by = var:quality
				position = 0

				save_scope_as = first_artifact
			}
			ordered_character_artifact = {
				limit = {
					artifact_type = necklace
					NOT = { this = first_artifact }
				}
				order_by = var:quality
				position = 100 #probability that anyone has over 100 weapons is very low, so to get the one with lowest quality

				save_scope_as = second_artifact
			}
		}
		else = {
			random_character_artifact = {
				limit = {
					artifact_type = necklace
				}

				save_scope_as = this_artifact
			}
		}
	}
	
	option = { #choose first artifact
		name = ancient_magic_alchemy.0112.only
		trigger = {
			any_character_artifact = {
				count = 1
				artifact_type = necklace
			}
		}
		
		hidden_effect = {
			scope:this_artifact = {
				save_scope_as = chosen_artifact
			}
		}
		
		trigger_event = ancient_magic_alchemy.0115
	}
	option = { #choose first artifact
		name = ancient_magic_alchemy.0112.best
		trigger = {
			any_character_artifact = {
				count > 1
				artifact_type = necklace
			}
		}
		
		hidden_effect = {
			scope:first_artifact = {
				save_scope_as = chosen_artifact
			}
		}
		
		trigger_event = ancient_magic_alchemy.0115
	}
	
	option = { #choose second artifact
		name = ancient_magic_alchemy.0112.worst
		trigger = {
			any_character_artifact = {
				count > 1
				artifact_type = necklace
			}
		}
		
		hidden_effect = {
			scope:second_artifact = {
				save_scope_as = chosen_artifact
			}
		}
		
		trigger_event = ancient_magic_alchemy.0115
	}
	
	option = { #Go back
		name = ancient_magic_alchemy.0125.back
		trigger_event = ancient_magic_alchemy.0107
	}
}

ancient_magic_alchemy.0113 = { #Choose trinket
	title = ancient_magic_alchemy.0113.t
	desc = ancient_magic_alchemy.0113.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	artifact = {
        target = scope:this_artifact
        position = lower_center_portrait  
		trigger = {
			ROOT = {
				any_character_artifact = {
					count = 1
					artifact_slot_type = miscellaneous
					NOT = { artifact_type = necklace }
					NOT = { 
						OR = { 
							has_artifact_feature_group = book_subject 
							has_artifact_feature_group = book_cover_material 
							has_artifact_feature_group = book_title 
							has_artifact_feature_group = book_topic 
							has_artifact_feature_group = book_decoration 
						}
					}
				}
			}
		}
    }
	artifact = { # To display the artifact in the event-window
        target = scope:first_artifact
        position = lower_left_portrait 
		trigger = {
			ROOT = {
				any_character_artifact = {
					count > 1
					artifact_slot_type = miscellaneous
					NOT = { artifact_type = necklace }
					NOT = { 
						OR = { 
							has_artifact_feature_group = book_subject 
							has_artifact_feature_group = book_cover_material 
							has_artifact_feature_group = book_title 
							has_artifact_feature_group = book_topic 
							has_artifact_feature_group = book_decoration 
						}
					}
				}
			}
		}
    }
	artifact = {
        target = scope:second_artifact
        position = lower_right_portrait 
		trigger = {
			ROOT = {
				any_character_artifact = {
					count > 1
					artifact_slot_type = miscellaneous
					NOT = { artifact_type = necklace }
					NOT = { 
						OR = { 
							has_artifact_feature_group = book_subject 
							has_artifact_feature_group = book_cover_material 
							has_artifact_feature_group = book_title 
							has_artifact_feature_group = book_topic 
							has_artifact_feature_group = book_decoration 
						}
					}
				}
			}
		}
    }
	
	immediate = {
		if = {
			limit = {
				any_character_artifact = {
					count > 1
					artifact_slot_type = miscellaneous
					NOT = { artifact_type = necklace }
					NOT = { 
						OR = { 
							has_artifact_feature_group = book_subject 
							has_artifact_feature_group = book_cover_material 
							has_artifact_feature_group = book_title 
							has_artifact_feature_group = book_topic 
							has_artifact_feature_group = book_decoration 
						}
					}
				}
			}
			ordered_character_artifact = {
				limit = {
					artifact_slot_type = miscellaneous
					NOT = { artifact_type = necklace }
					NOT = { 
						OR = { 
							has_artifact_feature_group = book_subject 
							has_artifact_feature_group = book_cover_material 
							has_artifact_feature_group = book_title 
							has_artifact_feature_group = book_topic 
							has_artifact_feature_group = book_decoration 
						}
					}
				}
				order_by = var:quality
				position = 0

				save_scope_as = first_artifact
			}
			ordered_character_artifact = {
				limit = {
					artifact_slot_type = miscellaneous
					NOT = { artifact_type = necklace }
					NOT = { 
						OR = { 
							has_artifact_feature_group = book_subject 
							has_artifact_feature_group = book_cover_material 
							has_artifact_feature_group = book_title 
							has_artifact_feature_group = book_topic 
							has_artifact_feature_group = book_decoration 
						}
					}
				}
				order_by = var:quality
				position = 100 #probability that anyone has over 100 weapons is very low, so to get the one with lowest quality

				save_scope_as = second_artifact
			}
		}
		else = {
			random_character_artifact = {
				limit = {
					artifact_slot_type = miscellaneous
					NOT = { artifact_type = necklace }
					NOT = { 
						OR = { 
							has_artifact_feature_group = book_subject 
							has_artifact_feature_group = book_cover_material 
							has_artifact_feature_group = book_title 
							has_artifact_feature_group = book_topic 
							has_artifact_feature_group = book_decoration 
						}
					}
				}

				save_scope_as = this_artifact
			}
		}
	}
	
	option = { #choose first artifact
		name = ancient_magic_alchemy.0113.only
		trigger = {
			any_character_artifact = {
				count = 1
				artifact_slot_type = miscellaneous
				NOT = { artifact_type = necklace }
				NOT = { 
					OR = { 
						has_artifact_feature_group = book_subject 
						has_artifact_feature_group = book_cover_material 
						has_artifact_feature_group = book_title 
						has_artifact_feature_group = book_topic 
						has_artifact_feature_group = book_decoration 
					}
				}
			}
		}
		
		hidden_effect = {
			scope:this_artifact = {
				save_scope_as = chosen_artifact
			}
		}
		
		trigger_event = ancient_magic_alchemy.0115
	}
	option = { #choose first artifact
		name = ancient_magic_alchemy.0113.best
		trigger = {
			any_character_artifact = {
				count > 1
				artifact_slot_type = miscellaneous
				NOT = { artifact_type = necklace }
				NOT = { 
					OR = { 
						has_artifact_feature_group = book_subject 
						has_artifact_feature_group = book_cover_material 
						has_artifact_feature_group = book_title 
						has_artifact_feature_group = book_topic 
						has_artifact_feature_group = book_decoration 
					}
				}
			}
		}
		
		hidden_effect = {
			scope:first_artifact = {
				save_scope_as = chosen_artifact
			}
		}
		
		trigger_event = ancient_magic_alchemy.0115
	}
	
	option = { #choose second artifact
		name = ancient_magic_alchemy.0113.worst
		trigger = {
			any_character_artifact = {
				count > 1
				artifact_slot_type = miscellaneous
				NOT = { artifact_type = necklace }
				NOT = { 
					OR = { 
						has_artifact_feature_group = book_subject 
						has_artifact_feature_group = book_cover_material 
						has_artifact_feature_group = book_title 
						has_artifact_feature_group = book_topic 
						has_artifact_feature_group = book_decoration 
					}
				}
			}
		}
		
		hidden_effect = {
			scope:second_artifact = {
				save_scope_as = chosen_artifact
			}
		}
		
		trigger_event = ancient_magic_alchemy.0115
	}
	
	option = { #Go back
		name = ancient_magic_alchemy.0125.back
		trigger_event = ancient_magic_alchemy.0107
	}}

ancient_magic_alchemy.0114 = { #Buy trinket
	title = ancient_magic_alchemy.0114.t
	desc = ancient_magic_alchemy.0114.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	artifact = {
        target = scope:this_artifact
        position = lower_center_portrait  
    }
	
	option = { #expensive trinket
		name = ancient_magic_alchemy.0114.a
		
		remove_short_term_gold = 150
		
		hidden_effect = {
			generate_random_trinket = { OWNER = ROOT QUALITY = "{ 20 30 }" SCOPE = chosen_artifact }
		}
		
		trigger_event = ancient_magic_alchemy.0115
	}
	option = { #averange trinket
		name = ancient_magic_alchemy.0114.b
		
		remove_short_term_gold = 75
		
		hidden_effect = {
			generate_random_trinket = { OWNER = ROOT QUALITY = "{ 10 20 }" SCOPE = chosen_artifact }
		}
		
		trigger_event = ancient_magic_alchemy.0115
	}
	
	option = { #cheap trinket
		name = ancient_magic_alchemy.0114.c
		
		remove_short_term_gold = 50
		
		hidden_effect = {
			generate_random_trinket = { OWNER = ROOT QUALITY = "{ 1 10 }" SCOPE = chosen_artifact }
		}
		
		trigger_event = ancient_magic_alchemy.0115
	}
	
	option = { #Go back
		name = ancient_magic_alchemy.0125.back
		trigger_event = ancient_magic_alchemy.0107
	}
}

#choose type of enchantment
ancient_magic_alchemy.0115 = {
	title = ancient_magic_alchemy.0115.t
	desc = ancient_magic_alchemy.0115.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	artifact = {
        target = scope:chosen_artifact
        position = lower_center_portrait  
    }
	
	immediate = {
		set_variable = {
			name = enchantment_type
			value = flag:none
		}
	}
		
	option = { #Atack type
		name = ancient_magic_alchemy.0115.a
		
		hidden_effect = {
			set_variable = {
				name = enchantment_type
				value = flag:attack
			}
		}
	}
	option = { #Defense based
		name = ancient_magic_alchemy.0115.b
		
		hidden_effect = {
			set_variable = {
				name = enchantment_type
				value = flag:defence
			}
		}
	}
	option = { #Support
		name = ancient_magic_alchemy.0115.c
		
		hidden_effect = {
			set_variable = {
				name = enchantment_type
				value = flag:support
			}
		}
	}
	
	after = {
		set_variable = {
			name = mana_drops_used
			value = 1
		}
		trigger_event = ancient_magic_alchemy.0116
	}
}

#choose ammount of mana drops used in enchantment experiment
ancient_magic_alchemy.0116 = {
	title = ancient_magic_alchemy.0116.t
	desc = ancient_magic_alchemy.0116.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	artifact = {
        target = scope:chosen_artifact
        position = lower_center_portrait  
    }
		
	option = { #use mana flask
		name = ancient_magic_alchemy.0116.mana_flask
		
		trigger = {
			any_ingredient_in_inventory = {
				has_artifact_feature = mana_vial
			}
		}
		
		random_ingredient_in_inventory = {
			limit = {
				has_artifact_feature = mana_vial
			}
			ROOT = {destroy_artifact = prev}
		}
		
		hidden_effect = {
			set_variable = { name = mana_drops_used value = mana_drops_needed_for_vial }
			trigger_event = ancient_magic_alchemy.0117
		}
	}
	option = { #increase
		name = ancient_magic_alchemy.0116.increase
		trigger = {
			any_ingredient_in_inventory = {
				count > var:mana_drops_used.compare_value
				has_artifact_feature = mana_drop
			}
		}
		show_as_unavailable = {
			any_ingredient_in_inventory = {
				has_artifact_feature = mana_drop
			}
			any_ingredient_in_inventory = {
				count <= var:mana_drops_used.compare_value
				has_artifact_feature = mana_drop
			}
		}
		
		hidden_effect = {
			change_variable = {	name = mana_drops_used	add = 1	}
			trigger_event = ancient_magic_alchemy.0116
		}
	}
	option = { #decrease
		name = ancient_magic_alchemy.0116.decrease
		trigger = {
			any_ingredient_in_inventory = {
				has_artifact_feature = mana_drop
			}
			var:mana_drops_used.compare_value > 1
		}
		show_as_unavailable = {
			any_ingredient_in_inventory = {
				has_artifact_feature = mana_drop
			}
			var:mana_drops_used.compare_value <= 1
		}
		
		hidden_effect = {
			change_variable = {	name = mana_drops_used	subtract = 1 min = 1 }
			trigger_event = ancient_magic_alchemy.0116
		}
	}
	option = { #accept
		name = ancient_magic_alchemy.0116.accept
		
		trigger = {
			any_ingredient_in_inventory = {
				has_artifact_feature = mana_drop
			}
		}
		
		hidden_effect = {
			trigger_event = ancient_magic_alchemy.0117
		}
	}
}

ancient_magic_alchemy.0117 = { #Random enchantment chooser
	type = character_event
	hidden = yes
	
	immediate = {
		set_variable = { #0 - 4
			name = enchantment_difficulity
			value = 0
		}
		set_local_variable = {
			name = failsafe_bool
			value = 0 #0 - False 	1 - True
		}
		switch = {
			trigger = var:enchantment_type
			flag:attack = {
				random_list = {
					100 = {
						trigger = { 
							has_perk = temporal_manipulation_perk
							NOT = { any_owned_alchemy_book = { is_target_in_variable_list = { name = enchantments target = flag:time_acceleration } } } 
						}
						change_variable = { name = enchantment_difficulity add = 4 }
						set_variable = { name = enchantment_name value = flag:time_acceleration }
					}
					100 = {
						trigger = { 
							has_perk = flaming_weapons_perk
							NOT = { any_owned_alchemy_book = { is_target_in_variable_list = { name = enchantments target = flag:fire_coating } } } 
						}
						change_variable = { name = enchantment_difficulity add = 2 }
						set_variable = { name = enchantment_name value = flag:fire_coating }
					}
					100 = {
						trigger = { 
							has_perk = elemental_warrior_perk
							NOT = { any_owned_alchemy_book = { is_target_in_variable_list = { name = enchantments target = flag:wind_acceleration } } } 
						}
						change_variable = { name = enchantment_difficulity add = 2 }
						set_variable = { name = enchantment_name value = flag:wind_acceleration }
					}
					100 = {
						trigger = { 
							has_perk = aura_of_death_perk
							NOT = { any_owned_alchemy_book = { is_target_in_variable_list = { name = enchantments target = flag:death_aura } } } 
						}
						change_variable = { name = enchantment_difficulity add = 3 }
						set_variable = { name = enchantment_name value = flag:death_aura }
					}
					100 = { set_variable = { name = enchantment_name value = flag:none } }
				}
			}
			flag:defence = {
				random_list = {
					100 = {
						trigger = { 
							has_perk = living_earthworks_perk
							NOT = { any_owned_alchemy_book = { is_target_in_variable_list = { name = enchantments target = flag:earth_strengthening } } } 
						}
						change_variable = { name = enchantment_difficulity add = 2 }
						set_variable = { name = enchantment_name value = flag:earth_strengthening }
					}
					100 = {
						trigger = { 
							has_perk = control_water_perk
							has_perk = battlefield_life_mage_perk
							NOT = { any_owned_alchemy_book = { is_target_in_variable_list = { name = enchantments target = flag:blood_defence } } } 
						}
						change_variable = { name = enchantment_difficulity add = 4 }
						set_variable = { name = enchantment_name value = flag:blood_defence }
					}
					100 = {
						trigger = { 
							has_perk = lord_of_the_elements_perk
							NOT = { any_owned_alchemy_book = { is_target_in_variable_list = { name = enchantments target = flag:elemental_defence } } } 
						}
						change_variable = { name = enchantment_difficulity add = 4 }
						set_variable = { name = enchantment_name value = flag:elemental_defence }
					}
					100 = {	set_variable = { name = enchantment_name value = flag:none } }
				}
			}
			flag:support = {
				random_list = {
					100 = {
						trigger = { 
							has_perk = heal_perk
							NOT = { any_owned_alchemy_book = { is_target_in_variable_list = { name = enchantments target = flag:minor_healing_aura } } } 
						}
						change_variable = { name = enchantment_difficulity add = 2 }
						set_variable = { name = enchantment_name value = flag:minor_healing_aura }
					}
					100 = {
						trigger = { 
							has_perk = greater_heal_perk
							NOT = { any_owned_alchemy_book = { is_target_in_variable_list = { name = enchantments target = flag:major_healing_aura } } } 
						}
						change_variable = { name = enchantment_difficulity add = 3 }
						set_variable = { name = enchantment_name value = flag:major_healing_aura }
					}
					100 = {
						trigger = { 
							has_perk = entrance_perk
							NOT = { any_owned_alchemy_book = { is_target_in_variable_list = { name = enchantments target = flag:mental_health_enhancement  } } } 
						}
						change_variable = { name = enchantment_difficulity add = 2 }
						set_variable = { name = enchantment_name value = flag:mental_health_enhancement  }
					}
					100 = {
						trigger = { 
							has_perk = inward_perfection_perk
							NOT = { any_owned_alchemy_book = { is_target_in_variable_list = { name = enchantments target = flag:fertility_boost } } } 
						}
						change_variable = { name = enchantment_difficulity add = 1 }
						set_variable = { name = enchantment_name value = flag:fertility_boost }
					}
					100 = { set_variable = { name = enchantment_name value = flag:none } }
				}
			}
			fallback = { change_local_variable = { name = failsafe_bool add = 1 } } #Failsafe
		}
		
		if = { #Start next event
			limit = { local_var:failsafe_bool.compare_value > 0 }
			trigger_event = ancient_magic_alchemy.5001
		}
		else = {
			trigger_event = ancient_magic_alchemy.0118
		}
	}
}

ancient_magic_alchemy.0118 = { #Enchantment chain decider - Success rate
	type = character_event
	hidden = yes
	
	immediate = {
		random_list = {
			100 = { #success
				modifier = {
					add = {
						value = scope:chosen_artifact.artifact_wealth_quality_average_value
						divide = var:enchantment_difficulity
					}
				}
				modifier = {
					factor = {
						value = laboratory_iron_tools_level_max
						subtract = {
							value = var:enchantment_difficulity
						}
						min = 1
					}
				}
				modifier = {
					factor = {
						value = laboratory_spellcircles_level_max
						subtract = {
							value = var:enchantment_difficulity
						}
						min = 1
					}
				}
				modifier = {
					factor = {
						value = laboratory_books_level_max
						subtract = {
							value = var:enchantment_difficulity
						}
						min = 1
					}
				}
				modifier = {
					add = {
						value = 20
						multiply = { 
							value = var:mana_drops_used
							subtract = 1
						}
						min = 0
					}
				}
				trigger_event = ancient_magic_alchemy.0119
			}
			200 = { # Fail
				modifier = {
					factor = {
						value = var:enchantment_difficulity
						subtract = {
							value = laboratory_iron_tools_level_max
						}
						min = 1
					}
				}
				modifier = {
					factor = {
						value = var:enchantment_difficulity
						subtract = {
							value = laboratory_spellcircles_level_max
						}
						min = 1
					}
				}
				modifier = {
					factor = {
						value = var:enchantment_difficulity
						subtract = {
							value = laboratory_books_level_max
						}
						min = 1
					}
				}
				modifier = {
					add = {
						value = 20
						multiply = var:enchantment_difficulity
						subtract = scope:chosen_artifact.artifact_wealth_quality_average_value
						min = 0
					}
				}
				random_list = {
					100 = { #Destroy artifact
						trigger_event = { id = ancient_magic_alchemy.5001 days = { 30 80 } }
					}
					50 = { #Explosion
						modifier = {
							factor = {
								value = var:enchantment_difficulity
								subtract = {
									value = laboratory_spellcircles_level_max
								}
								min = 0
							}
						}
						trigger_event = { id = ancient_magic_alchemy.5002 days = { 30 80 } }
					}
				}
			}
		}
	}
}

ancient_magic_alchemy.0119 = { #Enchantment chain decider - event caller
	type = character_event
	hidden = yes
	
	immediate = {
		switch = {
			trigger = var:enchantment_name
			flag:fire_coating = { trigger_event = { id = ancient_magic_alchemy.0500 days = { 40 120 } } }
			flag:wind_acceleration = { trigger_event = { id = ancient_magic_alchemy.0501 days = { 40 120 } } }
			flag:time_acceleration = { trigger_event = { id = ancient_magic_alchemy.0502 days = { 40 120 } } }
			flag:death_aura = { trigger_event = { id = ancient_magic_alchemy.0503 days = { 40 120 } } }
			flag:earth_strengthening = { trigger_event = { id = ancient_magic_alchemy.0600 days = { 40 120 } } }
			flag:blood_defence = { trigger_event = { id = ancient_magic_alchemy.0601 days = { 40 120 } } }
			flag:elemental_defence = { trigger_event = { id = ancient_magic_alchemy.0602 days = { 40 120 } } }
			flag:minor_healing_aura = { trigger_event = { id = ancient_magic_alchemy.0700 days = { 40 120 } } }
			flag:major_healing_aura = { trigger_event = { id = ancient_magic_alchemy.0701 days = { 40 120 } } }
			flag:fertility_boost = { trigger_event = { id = ancient_magic_alchemy.0702 days = { 40 120 } } }
			flag:mental_health_enhancement = { trigger_event = { id = ancient_magic_alchemy.0703 days = { 40 120 } } }
			fallback = { trigger_event = { id = ancient_magic_alchemy.5001 days = { 30 60 } } }
		}
	}
}

##Botanical alchemy choice
ancient_magic_alchemy.0125 = {
	title = ancient_magic_alchemy.0125.t
	desc = ancient_magic_alchemy.0125.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	option = { #Potions
		name = ancient_magic_alchemy.0125.potions
		trigger_event = ancient_magic_alchemy.0126
	}
	
	option = { #Magical plants experiments
		name = ancient_magic_alchemy.0125.plants
		trigger = {
			any_ingredient_in_inventory = {
				has_artifact_feature = mana_drop
			}
		}
		
		trigger_event = ancient_magic_alchemy.0127
	}
	
	option = { #Go back
		name = ancient_magic_alchemy.0125.back
		trigger_event = ancient_magic_alchemy.0101
	}
}

ancient_magic_alchemy.0126 = { #Potion crafting chain decider - event caller
	type = character_event
	hidden = yes
	
	immediate = {
		random_list = {
			1 = {
				trigger = { 
					always = no
					NOT = { any_owned_alchemy_book = { is_target_in_variable_list = { name = potions target = flag:healing_potion } } } 
				}
			}
			1 = {
				trigger = { 
					always = no
					NOT = { any_owned_alchemy_book = { is_target_in_variable_list = { name = potions target = flag:mana_refill_potion } } } 
				}
			}
			1 = { trigger_event = { id = ancient_magic_alchemy.1000 days = { 30 60 } } } #Love potion event
		}
	}
}

ancient_magic_alchemy.0127 = { #Herb crafting - investment
	title = ancient_magic_alchemy.0127.t
	desc = ancient_magic_alchemy.0127.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	immediate = {
		set_variable = {
			name = investment
			value = 0
		}
	}
	
	option = { #efficient investment
		name = ancient_magic_alchemy.0103.d
		remove_short_term_gold = 100
		trigger = {
			stewardship > 15
		}
		hidden_effect = {
			change_variable = { name = investment add = 3 }
		}
	}
	
	option = { #bare minimum
		name = ancient_magic_alchemy.0103.a
		remove_short_term_gold = 35
		hidden_effect = {
			change_variable = { name = investment add = 3 }
		}
	}
	
	option = { #medium investment
		name = ancient_magic_alchemy.0103.b
		remove_short_term_gold = 75
		hidden_effect = {
			change_variable = { name = investment add = 3 }
		}
	}
	
	option = { #great investment
		name = ancient_magic_alchemy.0103.c
		remove_short_term_gold = 150
		hidden_effect = {
			change_variable = { name = investment add = 3 }
		}
	}
	
	after = {
		set_variable = { name = mana_drops_used value = 0 }
		trigger_event = { id = ancient_magic_alchemy.0128 }
	}
}

ancient_magic_alchemy.0128 = { #Herb crafting - mana ammount
	title = ancient_magic_alchemy.0128.t
	desc = ancient_magic_alchemy.0128.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	artifact = {
        target = scope:chosen_artifact
        position = lower_center_portrait  
    }
		
	option = { #use mana flask
		name = ancient_magic_alchemy.0116.mana_flask
		
		trigger = {
			any_ingredient_in_inventory = {
				has_artifact_feature = mana_vial
			}
		}
		
		random_ingredient_in_inventory = {
			limit = {
				has_artifact_feature = mana_vial
			}
			ROOT = {destroy_artifact = prev}
		}
		
		hidden_effect = {
			set_variable = { name = mana_drops_used value = mana_drops_needed_for_vial }
			trigger_event = ancient_magic_alchemy.0129
		}
	}
	option = { #increase
		name = ancient_magic_alchemy.0116.increase
		trigger = {
			any_ingredient_in_inventory = {
				count > var:mana_drops_used.compare_value
				has_artifact_feature = mana_drop
			}
		}
		show_as_unavailable = {
			any_ingredient_in_inventory = {
				has_artifact_feature = mana_drop
			}
			any_ingredient_in_inventory = {
				count <= var:mana_drops_used.compare_value
				has_artifact_feature = mana_drop
			}
		}
		
		hidden_effect = {
			change_variable = {	name = mana_drops_used	add = 1	}
			trigger_event = ancient_magic_alchemy.0128
		}
	}
	option = { #decrease
		name = ancient_magic_alchemy.0116.decrease
		trigger = {
			any_ingredient_in_inventory = {
				has_artifact_feature = mana_drop
			}
			var:mana_drops_used.compare_value > 1
		}
		show_as_unavailable = {
			any_ingredient_in_inventory = {
				has_artifact_feature = mana_drop
			}
			var:mana_drops_used.compare_value <= 1
		}
		
		hidden_effect = {
			change_variable = {	name = mana_drops_used	subtract = 1 min = 1 }
			trigger_event = ancient_magic_alchemy.0128
		}
	}
	option = { #accept
		name = ancient_magic_alchemy.0116.accept
		
		trigger = {
			any_ingredient_in_inventory = {
				has_artifact_feature = mana_drop
			}
		}
		
		hidden_effect = {
			trigger_event = ancient_magic_alchemy.0129
		}
	}
}

ancient_magic_alchemy.0129 = { #Herb crafting - mana blood
	title = ancient_magic_alchemy.0129.t
	desc = ancient_magic_alchemy.0129.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	immediate = {
		if = {
			limit = {
				NOT = {
					any_ingredient_in_inventory = {
						has_artifact_feature_group = mana_blood
					}
				}
			}
			trigger_event = ancient_magic_alchemy.0130
		}
		
		ordered_ingredient_in_inventory = {
			has_artifact_feature_group = mana_blood
			order_by = var:mana_affinity
			position = 0
			save_scope_as = first_blood
		}
		ordered_ingredient_in_inventory = {
			has_artifact_feature_group = mana_blood
			order_by = var:mana_affinity
			position = 100
			save_scope_as = second_blood
		}
	}
	
	option = { #Use mana blood with highest mana_affinity
		name = ancient_magic_alchemy.0129.a
		hidden_effect = {
			scope:first_blood = {
				save_scope_as = chosen_blood
			}
			set_variable = { name = use_mana_blood value = 1 }
		}
		
	}
	
	option = { #Use mana blood with lowest mana_affinity
		name = ancient_magic_alchemy.0129.b
		trigger = { NOT = { scope:first_blood = scope:second_blood } }
		hidden_effect = {
			scope:second_blood = {
				save_scope_as = chosen_blood
			}
			set_variable = { name = use_mana_blood value = 1 }
		}
	}
	
	option = { #Not use mana blood
		name = ancient_magic_alchemy.0129.c
		hidden_effect = {
			set_variable = { name = use_mana_blood value = 0 }
		}
	}
	
	after = {
		trigger_event = ancient_magic_alchemy.0130
	}
}

ancient_magic_alchemy.0130 = { #Herb crafting - event chooser
	type = character_event
	hidden = yes
	
	immediate = {
		random_list = {
			1 = { #Man eating plant
				trigger = {
					var:use_mana_blood.compare_value > 0 #check if mana blood is used
				}
				trigger_event = { id = ancient_magic_alchemy.1250 days = { 40 100 } }
			}
			100 = { #Fallback event - found nothing
				modifier = {
					divide = var:investment
				}
				trigger_event = { id = ancient_magic_alchemy.5005 days = { 30 60 } }
			} 
		}
	}
}

##Magical Experiments (WIP)
ancient_magic_alchemy.0150 = {
	title = ancient_magic_alchemy.0150.t
	desc = ancient_magic_alchemy.0150.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	option = { #Transmutation
		name = ancient_magic_alchemy.0150.transmutation
	}
	
	option = { #Mana affinity experiments
		name = ancient_magic_alchemy.0150.mana_affinity
	}
}


## Combine materials ##
# New metal/ore event chain
ancient_magic_alchemy.0200 = { #Choose new metal/ore event (combined from mundane materials)
	type = character_event
	hidden = yes
	
	immediate = {
		random_list = {
			1 = { 
				trigger = { 
					NOT = { any_owned_alchemy_book = { is_target_in_variable_list = { name = metals target = flag:carbon_steel } } } 
				}
				trigger_event = ancient_magic_alchemy.0250 
			}
			10 = { #fallback event
				modifier = {
					divide = var:investment
				}
				trigger_event = ancient_magic_alchemy.5000 
			}
		}
	}
}
ancient_magic_alchemy.0201 = { #Choose new metal/ore event (magicaly enhancd materials)
	type = character_event
	hidden = yes
	
	immediate = {
		random_list = {
			1 = { 
				trigger = { 
					NOT = { any_owned_alchemy_book = { is_target_in_variable_list = { name = ores target = flag:mythril	} }	} 
				}
				trigger_event = ancient_magic_alchemy.0210 
			}
			1 = { #fallback event
				trigger_event = ancient_magic_alchemy.5000 
			}
		}
	}
}

# New magical metal/ore found
ancient_magic_alchemy.0210 = { #mythril
	title = ancient_magic_alchemy.0210.t
	desc = ancient_magic_alchemy.0210.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	immediate = {
		change_mage_xp = { VALUE = 500 }
 		add_learning_lifestyle_xp = minor_lifestyle_experience
		
		random_owned_alchemy_book = { 
			add_to_variable_list = {
				name = ores
				target = flag:mythril
			}
		}
	}
	
	option = { 
		name = ancient_magic_alchemy.0210.a
	}
	
	after = {
		create_ingredient_ore = { OWNER = ROOT TYPE = mythril }
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}

# New non-magical metal/ore found
ancient_magic_alchemy.0250 = { #carbon steel
	title = ancient_magic_alchemy.0200.t
	desc = ancient_magic_alchemy.0200.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	
	immediate = {
		change_mage_xp = { VALUE = 500 }
 		add_learning_lifestyle_xp = medium_lifestyle_experience
		
		random_owned_alchemy_book = { 
			add_to_variable_list = {
				name = metals
				target = flag:carbon_steel
			}
		}
	}
	
	option = { 
		name = ancient_magic_alchemy.0200.a
	}
	
	after = {
		create_ingredient_metal = { OWNER = ROOT TYPE = carbon_steel }
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}

##Enchantment##
# Newly found enchantments
#Attack
ancient_magic_alchemy.0500 = { #Fire coating
	title = ancient_magic_alchemy.0500.t
	desc = ancient_magic_alchemy.0500.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = ecstasy
	}
	
	immediate = {
 		add_learning_lifestyle_xp = medium_lifestyle_experience
		change_mage_xp = { VALUE = mage_xp_from_enchantment_experiment }
		
		random_owned_alchemy_book = { 
			add_to_variable_list = {
				name = enchantments
				target = flag:fire_coating
			}
		}
		
		scope:chosen_artifact = {
			give_artifact_an_enchantment_effect = { ENCHANTER = scope:enchanter ENCHANTMENT = fire_coating }
		}
	}
	
	option = {
		name = ancient_magic_alchemy.0500.a
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}
ancient_magic_alchemy.0501 = { #Wind Acceleration
	title = ancient_magic_alchemy.0501.t
	desc = ancient_magic_alchemy.0501.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = ecstasy
	}
	
	immediate = {
 		add_learning_lifestyle_xp = medium_lifestyle_experience
		change_mage_xp = { VALUE = 5000 }
		
		random_owned_alchemy_book = { 
			add_to_variable_list = {
				name = mage_xp_from_enchantment_experiment
				target = flag:wind_acceleration
			}
		}
		
		scope:chosen_artifact = {
			give_artifact_an_enchantment_effect = { ENCHANTER = scope:enchanter ENCHANTMENT = wind_acceleration }
		}
	}
	
	option = {
		name = ancient_magic_alchemy.0501.a
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}
ancient_magic_alchemy.0502 = { #Time Acceleration
	title = ancient_magic_alchemy.0502.t
	desc = ancient_magic_alchemy.0502.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = ecstasy
	}
	
	immediate = {
 		add_learning_lifestyle_xp = medium_lifestyle_experience
		change_mage_xp = { VALUE = mage_xp_from_enchantment_experiment }
		
		random_owned_alchemy_book = { 
			add_to_variable_list = {
				name = enchantments
				target = flag:time_acceleration
			}
		}
		
		scope:chosen_artifact = {
			give_artifact_an_enchantment_effect = { ENCHANTER = scope:enchanter ENCHANTMENT = time_acceleration }
		}
	}
	
	option = {
		name = ancient_magic_alchemy.0502.a
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}
ancient_magic_alchemy.0503 = { #Death Aura
	title = ancient_magic_alchemy.0503.t
	desc = ancient_magic_alchemy.0503.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = ecstasy
	}
	
	immediate = {
 		add_learning_lifestyle_xp = medium_lifestyle_experience
		change_mage_xp = { VALUE = mage_xp_from_enchantment_experiment }
		
		random_owned_alchemy_book = { 
			add_to_variable_list = {
				name = enchantments
				target = flag:death_aura
			}
		}
		
		scope:chosen_artifact = {
			give_artifact_an_enchantment_effect = { ENCHANTER = scope:enchanter ENCHANTMENT = death_aura }
		}
	}
	
	option = {
		name = ancient_magic_alchemy.0503.a
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}
#Defence
ancient_magic_alchemy.0600 = { #Earth strenghtening
	title = ancient_magic_alchemy.0600.t
	desc = ancient_magic_alchemy.0600.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = ecstasy
	}
	
	immediate = {
 		add_learning_lifestyle_xp = medium_lifestyle_experience
		change_mage_xp = { VALUE = mage_xp_from_enchantment_experiment }
		
		random_owned_alchemy_book = { 
			add_to_variable_list = {
				name = enchantments
				target = flag:earth_strengthening
			}
		}
		
		scope:chosen_artifact = {
			give_artifact_an_enchantment_effect = { ENCHANTER = scope:enchanter ENCHANTMENT = earth_strengthening }
		}
	}
	
	option = {
		name = ancient_magic_alchemy.0600.a
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}
ancient_magic_alchemy.0601 = { #Blood Defence
	title = ancient_magic_alchemy.0601.t
	desc = ancient_magic_alchemy.0601.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = ecstasy
	}
	
	immediate = {
 		add_learning_lifestyle_xp = medium_lifestyle_experience
		change_mage_xp = { VALUE = mage_xp_from_enchantment_experiment }
		
		random_owned_alchemy_book = { 
			add_to_variable_list = {
				name = enchantments
				target = flag:blood_defence
			}
		}
		
		scope:chosen_artifact = {
			give_artifact_an_enchantment_effect = { ENCHANTER = scope:enchanter ENCHANTMENT = blood_defence }
		}
	}
	
	option = {
		name = ancient_magic_alchemy.0601.a
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}
ancient_magic_alchemy.0602 = { #Elemental Defence
	title = ancient_magic_alchemy.0602.t
	desc = ancient_magic_alchemy.0602.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = ecstasy
	}
	
	immediate = {
 		add_learning_lifestyle_xp = medium_lifestyle_experience
		change_mage_xp = { VALUE = mage_xp_from_enchantment_experiment }
		
		random_owned_alchemy_book = { 
			add_to_variable_list = {
				name = enchantments
				target = flag:elemental_defence
			}
		}
		
		scope:chosen_artifact = {
			give_artifact_an_enchantment_effect = { ENCHANTER = scope:enchanter ENCHANTMENT = elemental_defence }
		}
	}
	
	option = {
		name = ancient_magic_alchemy.0602.a
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}
#Support
ancient_magic_alchemy.0700 = { #Minor Healing Aura
	title = ancient_magic_alchemy.0700.t
	desc = ancient_magic_alchemy.0700.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = ecstasy
	}
	
	immediate = {
 		add_learning_lifestyle_xp = medium_lifestyle_experience
		change_mage_xp = { VALUE = mage_xp_from_enchantment_experiment }
		
		random_owned_alchemy_book = { 
			add_to_variable_list = {
				name = enchantments
				target = flag:minor_healing_aura
			}
		}
		
		scope:chosen_artifact = {
			give_artifact_an_enchantment_effect = { ENCHANTER = scope:enchanter ENCHANTMENT = minor_healing_aura }
		}
	}
	
	option = {
		name = ancient_magic_alchemy.0700.a
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}
ancient_magic_alchemy.0701 = { #Major Healing Aura
	title = ancient_magic_alchemy.0701.t
	desc = ancient_magic_alchemy.0701.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = ecstasy
	}
	
	immediate = {
 		add_learning_lifestyle_xp = medium_lifestyle_experience
		change_mage_xp = { VALUE = mage_xp_from_enchantment_experiment }
		
		random_owned_alchemy_book = { 
			add_to_variable_list = {
				name = enchantments
				target = flag:major_healing_aura
			}
		}
		
		scope:chosen_artifact = {
			give_artifact_an_enchantment_effect = { ENCHANTER = scope:enchanter ENCHANTMENT = major_healing_aura }
		}
	}
	
	option = {
		name = ancient_magic_alchemy.0701.a
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}
ancient_magic_alchemy.0702 = { #Fertily
	title = ancient_magic_alchemy.0702.t
	desc = ancient_magic_alchemy.0702.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = ecstasy
	}
	
	immediate = {
 		add_learning_lifestyle_xp = medium_lifestyle_experience
		change_mage_xp = { VALUE = mage_xp_from_enchantment_experiment }
		
		random_owned_alchemy_book = { 
			add_to_variable_list = {
				name = enchantments
				target = flag:fertility_boost
			}
		}
		
		scope:chosen_artifact = {
			give_artifact_an_enchantment_effect = { ENCHANTER = scope:enchanter ENCHANTMENT = fertility_boost }
		}
	}
	
	option = {
		name = ancient_magic_alchemy.0702.a
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}
ancient_magic_alchemy.0703 = { #Mental Health Enhancement 
	title = ancient_magic_alchemy.0703.t
	desc = ancient_magic_alchemy.0703.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = ecstasy
	}
	
	immediate = {
 		add_learning_lifestyle_xp = medium_lifestyle_experience
		change_mage_xp = { VALUE = mage_xp_from_enchantment_experiment }
		
		random_owned_alchemy_book = { 
			add_to_variable_list = {
				name = enchantments
				target = flag:mental_health_enhancement
			}
		}
		
		scope:chosen_artifact = {
			give_artifact_an_enchantment_effect = { ENCHANTER = scope:enchanter ENCHANTMENT = mental_health_enhancement  }
		}
	}
	
	option = {
		name = ancient_magic_alchemy.0703.a
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}

# Item Enchantment

##Potions##
ancient_magic_alchemy.1000 = { #Love potion event chain
	title = ancient_magic_alchemy.0703.t
	desc = ancient_magic_alchemy.0703.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = ecstasy
	}
	
	option = {
		name = ancient_magic_alchemy.0703.a
	}
}

##Hebs##
ancient_magic_alchemy.1250 = { # Man eating plant
	title = ancient_magic_alchemy.0703.t
	desc = ancient_magic_alchemy.0703.desc
	type = character_event
	theme = learning_scholarship_focus
	
	immediate = {
 		add_learning_lifestyle_xp = medium_lifestyle_experience
		change_mage_xp = { VALUE = 5000 }
		add_character_modifier = man_eating_plant
	}
	
	left_portrait = {
		character = ROOT
		animation = ecstasy
	}
	
	option = {
		name = ancient_magic_alchemy.0703.a
	}
}

#### Alchemy ####
ancient_magic_alchemy.2000 = { #Decide what alchemy to do
	title = ancient_magic_alchemy.2000.t
	desc = ancient_magic_alchemy.2000.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = ecstasy
	}
	
	immediate = {
		ROOT = { save_scope_as = alchemist }
	}
	
	option = {
		name = ancient_magic_alchemy.2000.mythril
		trigger = {
			any_owned_alchemy_book = { is_target_in_variable_list = { name = metals target = flag:mythril } }
			mana_drops_in_inventory >= 3 
		}
		remove_short_term_gold = 75
		hidden_effect = {
			trigger_event = ancient_magic_alchemy.2005
			set_variable = { name = chosen_alchemy_product value = flag:mythril }
			set_variable = { name = mana_drop_cost value = 3 }
			set_variable = { name = alchemy_dificulity value = 1 }
		}
	}
	
	option = {
		name = ancient_magic_alchemy.2000.carbon_steel
		trigger = {
			any_owned_alchemy_book = { is_target_in_variable_list = { name = metals target = flag:carbon_steel } }
			mana_drops_in_inventory >= 1
		}
		remove_short_term_gold = 100
		hidden_effect = {
			trigger_event = ancient_magic_alchemy.2006
			set_variable = { name = chosen_alchemy_product value = flag:carbon_steel }
			set_variable = { name = mana_drop_cost value = 1 }
			set_variable = { name = alchemy_dificulity value = 1 }
		}
	}
	
	option = { #exit
		name = ancient_magic_alchemy.0050.exit
		trigger = {
			is_ai = no
		}
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}

ancient_magic_alchemy.2005 = { #Automatic event caller
	type = character_event
	hidden = yes
	
	immediate = {
		#Pay the mana drops needed
		pay_mana_drop_cost_effect = { OWNER = ROOT COST = var:mana_drop_cost }
		
		random_list = {
			10 = {
				modifier = {
					add = {
						value = 5
						multiply = laboratory_level
						divide = var:alchemy_dificulity
						min = 0
					}
				}
				switch = {
					trigger = var:chosen_alchemy_product
					flag:mythril = { trigger_event = { id = ancient_magic_alchemy.2100 days = { 30 60 } } }
					flag:carbon_steel = { trigger_event = { id = ancient_magic_alchemy.2101 days = { 30 60 } } }
					fallback = { trigger_event = ancient_magic_alchemy.5010 }
				}
			}
			10 = {
				modifier = {
					add = {
						value = 35
						multiply = var:alchemy_dificulity
						min = 0
					}
				}
				trigger_event = { id = ancient_magic_alchemy.5010 days = { 30 60 } }
			}
		}
	}
}

#Created metals
ancient_magic_alchemy.2100 = { #mythril
	title = ancient_magic_alchemy.2000.t
	desc = ancient_magic_alchemy.2000.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = ecstasy
	}
	
	immediate = {
		change_mage_xp = { VALUE = 150 }
	}
	
	option = { 
		name = ancient_magic_alchemy.0200.a
	}
	
	after = {
		create_ingredient_ore = { OWNER = ROOT TYPE = mythril }
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
	
}
ancient_magic_alchemy.2101 = { #carbon steel
	title = ancient_magic_alchemy.2000.t
	desc = ancient_magic_alchemy.2000.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = ecstasy
	}
	
	immediate = {
		change_mage_xp = { VALUE = 150 }
	}
	
	option = { 
		name = ancient_magic_alchemy.0200.a
	}
	
	after = {
		create_ingredient_metal = { OWNER = ROOT TYPE = carbon_steel }
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}
#### Forginf Magical Artifacts ####


# Fail - nothing found
ancient_magic_alchemy.5000 = {
	title = ancient_magic_alchemy.5000.t
	desc = ancient_magic_alchemy.5000.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = sadness
	}
	
	immediate = {
 		add_learning_lifestyle_xp = medium_lifestyle_experience
	}
	
	option = { 
		name = ancient_magic_alchemy.5000.a
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}
#Enchantment Failed - destroy artifact
ancient_magic_alchemy.5001 = {
	title = ancient_magic_alchemy.5001.t
	desc = ancient_magic_alchemy.5001.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = sadness
	}
	
	immediate = {
 		add_learning_lifestyle_xp = medium_lifestyle_experience
		change_mage_xp = { VALUE = medium_lifestyle_experience }
		destroy_artifact = scope:chosen_artifact
	}
	
	option = { 
		name = ancient_magic_alchemy.5001.a
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}
#Enchantment Failed - Explosion
ancient_magic_alchemy.5002 = {
	title = ancient_magic_alchemy.5002.t
	desc = ancient_magic_alchemy.5002.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = shock
	}
	
	immediate = {
 		add_learning_lifestyle_xp = medium_lifestyle_experience
		change_mage_xp = { VALUE = medium_lifestyle_experience }
		destroy_artifact = scope:chosen_artifact
	}
	
	option = { 
		name = ancient_magic_alchemy.5002.a
		random_list = {
			30 = { #nothingg bad happens only artifact is destroyed
				modifier = {
					add = {
						value = 10
						multiply = laboratory_spellcircles_level
						min = 0
					}
				}
				modifier = {
					multiply = {
						value = 2
						multiply = laboratory_spellcircles_level
						min = 1
					}
				}
			}
			30 = { #enchanter gets wounded
				modifier = {
					divide = {
						value = 1
						multiply = laboratory_spellcircles_level
						min = 1
					}
				}
				scope:enchanter = {
					add_trait = wounded_1
				}
			}
			30 = { #enchanter gets severly injured
				modifier = {
					divide = {
						value = 2
						multiply = laboratory_spellcircles_level
						min = 1
					}
				}
				scope:enchanter = {
					add_trait = wounded_2
				}
			}
			30 = { #enchanter is maimed
				modifier = {
					divide = {
						value = 3
						multiply = laboratory_spellcircles_level
						min = 1
					}
				}
				scope:enchanter = {
					add_trait = wounded_3
				}
			}
			5 = { #enchanter dies
				modifier = {
					divide = {
						value = 4
						multiply = laboratory_spellcircles_level
						min = 1
					}
				}
				scope:enchanter = {
					death = {
						death_reason = death_enchatment_explosion
					}
				}
			}
		}
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}
#Hebology - fail
ancient_magic_alchemy.5005 = {
	title = ancient_magic_alchemy.5005.t
	desc = ancient_magic_alchemy.5005.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = sadness
	}
	
	immediate = {
 		add_learning_lifestyle_xp = minor_lifestyle_experience
		add_character_modifier = magical_fertilizer
		change_mage_xp = { VALUE = 150 }
	}
	
	option = { 
		name = ancient_magic_alchemy.5005.a
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}

#Alchemy - fail
ancient_magic_alchemy.5010 = {
	title = ancient_magic_alchemy.5010.t
	desc = ancient_magic_alchemy.5010.desc
	type = character_event
	theme = learning_scholarship_focus
	
	left_portrait = {
		character = ROOT
		animation = sadness
	}
	
	immediate = {
 		add_learning_lifestyle_xp = minor_lifestyle_experience
		change_mage_xp = { VALUE = 25 }
	}
	
	option = { 
		name = ancient_magic_alchemy.5010.a
	}
	
	after = {
		hidden_effect = {
			scope:activity = {
				complete_activity = yes
			}
		}
	}
}